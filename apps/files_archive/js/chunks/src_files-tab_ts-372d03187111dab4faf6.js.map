{"version":3,"file":"js/chunks/src_files-tab_ts-372d03187111dab4faf6.js","mappings":"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","sources":["webpack://files-archive/./src/toolkit/util/generate-url.ts","webpack://files-archive/./src/toolkit/util/file-node-helper.ts","webpack://files-archive/./src/toolkit/types/axios-type-guards.ts","webpack://files-archive/./src/toolkit/util/nextcloud-sidebar-root.ts","webpack://files-archive/./src/views/FilesTab.vue?0864","webpack://files-archive/./src/views/FilesTab.vue?a30a","webpack://files-archive/FilesTab.vue","webpack://files-archive/./src/views/FilesTab.vue?3e00","webpack://files-archive/./src/views/FilesTab.vue","webpack://files-archive/./src/files-tab.ts"],"sourcesContent":["/**\n * @copyright Copyright (c) 2022-2025 Claus-Justus Heine <himself@claus-justus-heine.de>\n *\n * @author Claus-Justus Heine <himself@claus-justus-heine.de>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\n\nimport { appName } from '../../config.ts';\nimport {\n  generateUrl as nextcloudGenerateUrl,\n  generateOcsUrl as nextcloudGenerateOcsUrl,\n} from '@nextcloud/router';\nimport type { UrlOptions } from '@nextcloud/router';\n\n/**\n * Generate an absolute URL for this app.\n *\n * @param url The locate URL without app-prefix.\n *\n * @param urlParams Object holding url-parameters if url\n * contains parameters. \"Excess\" parameters will be appended as query\n * parameters to the URL.\n *\n * @param urlOptions Object with query parameters\n */\nexport const generateUrl = <T extends string>(url: T, urlParams?: Record<string, string|number|boolean|null>, urlOptions?: UrlOptions) => {\n  // const str = '/image/{joinTable}/{ownerId}';\n  url = url.replace(/^\\/+/g, '') as T;\n  let generated = nextcloudGenerateUrl('/apps/' + appName + '/' + url, urlParams, urlOptions);\n  // remove missing parameters as optional\n  generated = generated.replace(/\\/%7B[^%]+%7D/g, '');\n  const queryParams = { ...(urlParams || {}) };\n  for (const urlParam of url.matchAll(/{([^{}]*)}/g)) {\n    delete queryParams[urlParam[1]];\n  }\n  const queryArray: string[] = [];\n  for (const [key, value] of Object.entries(queryParams)) {\n    try {\n      queryArray.push(key + '=' + encodeURIComponent(value?.toString() || ''));\n    } catch (e) {\n      console.debug('STRING CONVERSION ERROR', e);\n    }\n  }\n  if (queryArray.length > 0) {\n    generated += '?' + queryArray.join('&');\n  }\n  return generated;\n};\n\nexport const generateOcsUrl = <T extends string>(url: T, urlParams?: Record<string, string|number|boolean|null>, urlOptions?: UrlOptions) => {\n  let generated = nextcloudGenerateOcsUrl('/apps/' + appName + '/' + url, urlParams, urlOptions);\n  const queryParams = { ...urlParams };\n  for (const urlParam of url.matchAll(/{([^{}]*)}/g)) {\n    delete queryParams[urlParam[1]];\n  }\n  const queryArray: string[] = [];\n  for (const [key, value] of Object.entries(queryParams)) {\n    try {\n      queryArray.push(key + '=' + encodeURIComponent(value?.toString() || ''));\n    } catch (e) {\n      console.debug('STRING CONVERSION ERROR', e);\n    }\n  }\n  if (queryArray.length > 0) {\n    generated += '?' + queryArray.join('&');\n  }\n  return generated;\n};\n\nexport default generateUrl;\n","/**\n * @copyright Copyright (c) 2024, 2025, 2025 Claus-Justus Heine <himself@claus-justus-heine.de>\n * @author Claus-Justus Heine <himself@claus-justus-heine.de>\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\n\nimport { getCurrentUser } from '@nextcloud/auth';\nimport { join } from 'path';\nimport { File, Folder, FileType } from '@nextcloud/files';\nimport { generateRemoteUrl } from '@nextcloud/router';\n\nexport interface FileInfoDTO {\n  fileid: number,\n  path: string,\n  topLevelFolder: string,\n  relativePath: string,\n  basename: string,\n  lastmod: number,\n  mime: string,\n  size: number,\n  type: FileType,\n  hasPreview: boolean,\n  permissions: number,\n  'mount-type': string,\n  etag: string,\n}\n\n/**\n * @param fileInfo File-info object.\n *\n * @param owner If undefined the current user is used.\n *\n * @return Result.\n */\nexport const fileInfoToNode = (fileInfo: FileInfoDTO, owner?: string) => {\n  owner = owner || getCurrentUser()!.uid;\n  const userFrontEndFolder = '/' + owner + '/files';\n  if (fileInfo.topLevelFolder !== userFrontEndFolder) {\n    throw new Error(`${fileInfo.path} is located outside of the front end user file space ${userFrontEndFolder}.`);\n  }\n  const nodeData = {\n    id: fileInfo.fileid,\n    source: generateRemoteUrl(join('dav/files', owner, fileInfo.relativePath)),\n    root: `/files/${owner}`,\n    mime: fileInfo.mime,\n    mtime: new Date(fileInfo.lastmod * 1000),\n    owner,\n    size: fileInfo.size,\n    permissions: fileInfo.permissions,\n    attributes: {\n      ...fileInfo,\n      'has-preview': fileInfo.hasPreview,\n    },\n  };\n  return fileInfo.type === 'file' ? new File(nodeData) : new Folder(nodeData);\n};\n","/**\n * Orchestra member, musicion and project management application.\n *\n * CAFEVDB -- Camerata Academica Freiburg e.V. DataBase.\n *\n * @author Claus-Justus Heine\n * @copyright 2025 Claus-Justus Heine <himself@claus-justus-heine.de>\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport axios, { AxiosError } from 'axios';\nimport type { AxiosResponse } from 'axios';\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport interface AxiosErrorResponse<T = unknown, D = any> extends Omit<AxiosError<T, D>, 'response'> {\n  response: AxiosResponse<T, D>,\n}\n\nexport const isAxiosError = (error: unknown): error is AxiosError => axios.isAxiosError(error);\n\nexport const isAxiosErrorResponse = (error: unknown): error is AxiosErrorResponse =>\n  isAxiosError(error) && !!error.response;\n","/**\n * @author Claus-Justus Heine\n * @copyright 2025 Claus-Justus Heine <himself@claus-justus-heine.de>\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport Vue, { getCurrentInstance } from 'vue';\nimport { NodeStatus } from '@nextcloud/files';\nimport { emit } from '@nextcloud/event-bus';\nimport type { Node } from '@nextcloud/files';\n\nlet currentInstance: null|Vue = null;\n\ntype SidebarRoot = Vue & { node?: Node };\n\nlet sidebarRoot: null|SidebarRoot = null;\n\nconst busyNodes: Node[] = [];\n\n/**\n * Find the root of the right sidebar in order to get access to\n * interesting properties like the current Node-object.\n */\nexport const getSidebarRoot = () => {\n  let instance = getCurrentInstance()?.proxy || null;\n  if (sidebarRoot && ((instance && currentInstance === instance) || (!instance && currentInstance))) {\n    return sidebarRoot;\n  }\n  if (instance) {\n    currentInstance = instance;\n  } else {\n    instance = currentInstance;\n  }\n  while (instance && instance.$parent && instance.$options.name !== 'SidebarRoot') {\n    instance = instance?.$parent;\n  }\n  sidebarRoot = instance || null;\n  return sidebarRoot;\n};\n\nexport const getSidebarNode = () => {\n  const sidebarRoot = getSidebarRoot();\n  return sidebarRoot?.node || null;\n};\n\nexport const setSidebarNodeBusy = (state: boolean = true) => {\n  const node = getSidebarNode();\n  if (node && state) {\n    node.status = NodeStatus.LOADING;\n    emit('files:node:updated', node);\n    busyNodes.push(node);\n  } else {\n    for (const node of busyNodes) {\n      node.status = undefined;\n      emit('files:node:updated', node);\n    }\n    busyNodes.splice(0, busyNodes.length);\n  }\n};\n\nexport const clearSidebarNodeBusy = () => setSidebarNodeBusy(false);\n","import { defineComponent as _defineComponent } from 'vue'\nimport { appName } from '../config.ts'\nimport {\n  computed,\n  reactive,\n  ref,\n  set as vueSet,\n  del as vueDel,\n  onBeforeMount,\n  onUnmounted,\n  nextTick,\n} from 'vue'\nimport getInitialState from '../toolkit/util/initial-state.ts'\nimport { generateUrl, generateRemoteUrl } from '@nextcloud/router'\nimport { emit, subscribe, unsubscribe } from '@nextcloud/event-bus'\nimport { getCurrentUser } from '@nextcloud/auth'\nimport generateAppUrl from '../toolkit/util/generate-url.ts'\nimport { fileInfoToNode } from '../toolkit/util/file-node-helper.ts'\nimport type { FileInfoDTO } from '../toolkit/util/file-node-helper.ts'\nimport { md5 } from 'js-md5'\nimport { showError, showInfo, TOAST_PERMANENT_TIMEOUT } from '@nextcloud/dialogs'\nimport { translate as t } from '@nextcloud/l10n'\nimport NetworkOffIcon from 'vue-material-design-icons/NetworkOff.vue'\nimport CancelIcon from 'vue-material-design-icons/Cancel.vue'\nimport { formatFileSize } from '@nextcloud/files'\nimport {\n  NcActionInput,\n  NcActionCheckbox,\n  NcActions,\n  NcActionButton,\n  NcListItem,\n} from '@nextcloud/vue'\nimport FilePrefixPicker from '@rotdrop/nextcloud-vue-components/lib/components/FilePrefixPicker.vue'\nimport axios from '@nextcloud/axios'\nimport type { LegacyFileInfo, Node } from '@nextcloud/files'\nimport { isAxiosErrorResponse } from '../toolkit/types/axios-type-guards.ts'\nimport type { NextcloudEvents } from '@nextcloud/event-bus'\nimport type {\n  ArchiveMount,\n  ArchiveMountEntity,\n  GetArchiveMountResponse,\n} from '../model/archive-mount.d.ts'\nimport { setSidebarNodeBusy as setBusyState } from '../toolkit/util/nextcloud-sidebar-root.ts'\nimport logger from '../console.ts'\nimport type { InitialState } from '../types/initial-state.d.ts'\n\ninterface ArchiveInfo {\n  commonPathPrefix: string,\n  compressedSize: number,\n  defaultMountPoint: string,\n  defaultTargetBaseName: string,\n  numberOfFiles: number,\n  originalSize: number,\n  size: number,\n  format: string,\n  mimeType: string,\n  backendDriver: string,\n  comment?: string,\n}\n\ninterface ArchiveJob {\n  target: 'mount'|'extract',\n  userId: string,\n  sourceId: number,\n  sourcePath: string,\n  destinationPath: string,\n  archivePassphrase?: string,\n  stripCommonPathPrefix: boolean,\n  needsAuthentication: boolean,\n  authToken: string,\n}\n\ninterface ArchiveInfoResponse {\n  messages: string[],\n  archiveStatus: number, //\n  archiveInfo: ArchiveInfo,\n}\n\ninterface CancelJobResponse {\n  removed?: ArchiveJob[],\n  messages?: string[],\n}\n\n\nexport default /*#__PURE__*/_defineComponent({\n  __name: 'FilesTab',\n  setup(__props, { expose }) {\n\nsetBusyState(false) // needs to be done once while in setup mode\n\nconst archivePassPhraseComponent = ref<null|typeof NcActionInput>(null)\nconst mountOptionsComponent = ref<null|typeof NcActions>(null)\nconst extractionOptionsComponent = ref<null|typeof NcActions>(null)\n\nconst loading = ref(0)\n\nconst fileInfo = ref<undefined|LegacyFileInfo>(undefined)\nconst fileName = computed(() => fileInfo.value ? fileInfo.value.path + '/' + fileInfo.value.name : null)\nconst archiveFileId = computed(() => fileInfo.value?.id)\n\nconst ArchiveStatusOk = 0\nconst ArchiveStatusTooLarge = 1\nconst ArchiveStatusBomb = 2\n\nconst archiveInfo = ref<undefined|ArchiveInfo>(undefined)\nconst archiveStatus = ref<undefined|number>(undefined)\n\nconst archiveMounts = ref<ArchiveMount[]>([])\n\nconst pendingJobs = ref<Record<string, ArchiveJob> >({})\nconst jobsArePending = computed(() => Object.keys(pendingJobs.value).length > 0)\n\nconst initialState = getInitialState<InitialState>()\n\nconst archiveMountStripCommonPathPrefix = ref(!!initialState?.mountStripCommonPathPrefixDefault)\nconst archiveExtractStripCommonPathPrefix = ref(!!initialState?.extractStripCommonPathPrefixDefault)\nconst archiveMountBackgroundJob = ref(!!initialState?.mountBackgroundJob)\nconst archiveExtractBackgroundJob = ref(!!initialState?.extractBackgroundJob)\nconst archivePassPhrase = ref<undefined|string>(undefined)\n\nconst showArchiveInfo = ref(true)\nconst showArchivePassPhrase = ref(false)\nconst showArchiveMounts = ref(false)\nconst showArchiveExtraction = ref(false)\nconst showPendingJobs = ref(false)\nconst openMountTarget = computed(() => md5(generateUrl('') + appName + '-open-archive-mount'))\n\nconst archiveMountFileInfo = reactive({\n  dirName: '',\n  baseName: '',\n})\n\nconst archiveExtractFileInfo = reactive({\n  dirName: '',\n  baseName: '',\n})\n\nconst archiveMountBaseName = computed({\n  get() {\n    return archiveMountFileInfo.baseName\n  },\n  set(value) {\n    vueSet(archiveMountFileInfo, 'baseName', value)\n    return value\n  },\n})\n\nconst archiveMountDirName = computed({\n  get() {\n    return archiveMountFileInfo.dirName\n  },\n  set(value) {\n    vueSet(archiveMountFileInfo, 'dirName', value)\n    return value\n  },\n})\n\nconst archiveExtractBaseName = computed({\n  get() {\n    return archiveExtractFileInfo.baseName\n  },\n  set(value) {\n    vueSet(archiveExtractFileInfo, 'baseName', value)\n    return value\n  },\n})\n\nconst archiveExtractDirName = computed({\n  get() {\n    return archiveExtractFileInfo.dirName\n  },\n  set(value) {\n    vueSet(archiveExtractFileInfo, 'dirName', value)\n    return value\n  },\n})\n\nconst archiveMountPathName = computed(() => archiveMountDirName.value + (archiveMountBaseName.value ? '/' + archiveMountBaseName.value : ''))\nconst archiveExtractPathName = computed(() => archiveExtractDirName.value + (archiveExtractBaseName.value ? '/' + archiveExtractBaseName.value : ''))\n\nconst archiveStatusText = computed(() => {\n  if (archiveStatus.value! === ArchiveStatusOk) {\n    return t(appName, 'ok')\n  } else if (archiveStatus.value! & ArchiveStatusBomb) {\n    return t(appName, 'zip bomb')\n  } else if (archiveStatus.value! & ArchiveStatusTooLarge) {\n    return t(appName, 'too large')\n  }\n  return t(appName, 'unknown')\n})\n\n// const archiveFileDirName = computed(() => fileInfo.value?.path)\n// const archiveFileBaseName = computed(() => fileInfo.value?.name)\n// const archiveFilePathName = computed(() => fileInfo.value?.path + '/' + fileInfo.value?.name)\nconst archiveMounted = computed(() => archiveMounts.value.length > 0)\n// const archiveInfoText = computed(() => JSON.stringify(archiveInfo.value, null, 2))\nconst humanArchiveOriginalSize = computed(() =>\n  !isNaN(parseInt('' + archiveInfo.value?.originalSize))\n    ? formatFileSize(archiveInfo.value!.originalSize)\n    : t(appName, 'unknown'),\n)\nconst humanArchiveCompressedSize = computed(() =>\n  !isNaN(parseInt('' + archiveInfo.value?.compressedSize))\n    ? formatFileSize(archiveInfo.value!.compressedSize)\n    : t(appName, 'unknown'),\n)\nconst humanArchiveFileSize = computed(() =>\n  !isNaN(parseInt('' + archiveInfo.value?.size))\n    ? formatFileSize(archiveInfo.value!.size)\n    : t(appName, 'unknown'),\n)\nconst numberOfArchiveMembers = computed(() => {\n  if (!archiveInfo.value\n      || archiveInfo.value?.numberOfFiles === undefined\n      || isNaN(parseInt('' + archiveInfo.value?.numberOfFiles))) {\n    return t(appName, 'unknown')\n  }\n  return '' + archiveInfo.value?.numberOfFiles\n})\nconst commonPathPrefix = computed(() =>\n  !archiveInfo.value\n    || archiveInfo.value.commonPathPrefix === undefined\n    ? t(appName, 'unknown')\n    : '/' + archiveInfo.value.commonPathPrefix,\n)\n// const mountPointTitle = computed(() =>\n//   t(appName, 'Mount Points')\n//     + ' ('\n//     + (archiveMounted ? archiveMounts.value.length : t(appName, 'not mounted'))\n//     + ')'\n// )\n\n// We ____DO____  want to compare numerically here.\nconst isLt = (a: null|undefined|number, b: null|undefined|number) => a! < b!\n\nconst openMountOptionsMenu = () => {\n  mountOptionsComponent.value?.openMenu()\n}\n\nconst openExtractionOptionsMenu = () => {\n  extractionOptionsComponent.value?.openMenu()\n}\n\n/**\n * Fetch some needed data ...\n */\nconst getData = async () => {\n  archiveMountStripCommonPathPrefix.value = !!initialState?.mountStripCommonPathPrefixDefault\n  archiveExtractStripCommonPathPrefix.value = !!initialState?.extractStripCommonPathPrefixDefault\n  archiveMountBackgroundJob.value = !!initialState?.mountBackgroundJob\n  archiveExtractBackgroundJob.value = !!initialState?.extractBackgroundJob\n\n  if (!fileName.value) {\n    return\n  }\n\n  getArchiveInfo(fileName.value)\n  refreshArchiveMounts(fileName.value, true)\n  getPendingJobs(fileName.value, true)\n}\n\n/**\n * Update current fileInfo and fetch new data\n * @param newFileInfo the current file FileInfo\n */\nconst update = async (newFileInfo: LegacyFileInfo) => {\n  fileInfo.value = newFileInfo\n\n  /* this.fileList = OCA.Files.App.currentFileList\n   * this.fileList.$el.off('updated').on('updated', function(event) {\n   *   logger.info('FILE LIST UPDATED, ARGS', arguments)\n   * }) */\n  archiveMountBaseName.value = fileInfo.value.name.split('.')[0]\n  archiveMountDirName.value = fileInfo.value.path\n\n  archiveExtractBaseName.value = archiveMountBaseName.value\n  archiveExtractDirName.value = archiveMountDirName.value\n\n  getData()\n}\n\nexpose({ update })\n\nconst getArchiveInfo = async (fileName: string) => {\n  ++loading.value\n  fileName = encodeURIComponent(fileName)\n  const url = generateAppUrl('archive/info/{fileName}', { fileName })\n  const requestData: Record<string, string> = {}\n  if (archivePassPhrase.value) {\n    requestData.passPhrase = archivePassPhrase.value\n  }\n  try {\n    const response = await axios.post<ArchiveInfoResponse>(url, requestData)\n    const responseData = response.data\n    archiveInfo.value = responseData.archiveInfo\n    archiveStatus.value = responseData.archiveStatus\n    if (responseData.messages) {\n      for (const message of responseData.messages) {\n        showInfo(message)\n      }\n    }\n  } catch (e) {\n    logger.error('ERROR', e)\n    if (isAxiosErrorResponse(e) && e.response.data) {\n      const responseData = e.response.data as ArchiveInfoResponse\n      archiveInfo.value = responseData.archiveInfo\n      archiveStatus.value = responseData.archiveStatus\n      if (responseData.messages) {\n        for (const message of responseData.messages) {\n          showError(message, { timeout: TOAST_PERMANENT_TIMEOUT })\n        }\n      }\n    } else {\n      archiveInfo.value = undefined\n    }\n  }\n  if (archiveInfo.value?.defaultMountPoint) {\n    archiveMountBaseName.value = archiveInfo.value.defaultMountPoint\n  }\n  if (archiveInfo.value?.defaultTargetBaseName) {\n    archiveExtractBaseName.value = archiveInfo.value.defaultTargetBaseName\n  }\n  --loading.value\n}\n\nconst refreshArchiveMounts = async (filename: string, noEmit?: boolean) => {\n  const oldMounts = [...archiveMounts.value]\n  const mounts = await getArchiveMounts(filename, false)\n  archiveMounts.value = mounts.mounts\n  if (noEmit) {\n    // do no emit birth during initialization\n    return\n  }\n  // emit birth and death signals as needed, in order to update\n  // the frontend file-listing. The computational effort is\n  // quadratic, but we are talking here about the common case that\n  // there is only a single mount -- or by accident another\n  // one. So what.\n  const newMounts = archiveMounts.value.filter((mount) => oldMounts.findIndex((oldMount) => mount.mountPoint.fileid === oldMount.mountPoint.fileid) === -1)\n  const deletedMounts = oldMounts.filter((oldMount) => archiveMounts.value.findIndex((mount) => mount.mountPoint.fileid === oldMount.mountPoint.fileid) === -1)\n  for (const mount of deletedMounts) {\n    const node = fileInfoToNode(mount.mountPoint)\n    node.attributes['is-mount-root'] = true\n\n    emit('files:node:deleted', node)\n  }\n  for (const mount of newMounts) {\n    const node = fileInfoToNode(mount.mountPoint)\n    node.attributes['is-mount-root'] = true\n\n    emit('files:node:created', node)\n  }\n}\n\nconst getJobIdFromOperation = (operation: string, archivePath: string, mountPath: string) => {\n  return md5(operation + archivePath + mountPath)\n}\n\nconst getJobIdFromJob = (job: ArchiveJob) => {\n  return getJobIdFromOperation(job.target, job.sourcePath, job.destinationPath)\n}\n\nconst getPendingJobs = async (fileName: string, silent?: boolean) => {\n  if (silent !== true) {\n    ++loading.value\n  }\n  fileName = encodeURIComponent(fileName)\n  const url = generateAppUrl('archive/schedule/{operation}/{fileName}', { operation: 'status', fileName })\n  try {\n    const response = await axios.get<ArchiveJob[]>(url)\n    const responseData = response.data\n    const jobs = {}\n    for (const job of responseData) {\n      jobs[getJobIdFromJob(job)] = job\n    }\n    for (const jobId of Object.keys(pendingJobs.value)) {\n      if (!jobs[jobId]) {\n        vueDel(pendingJobs.value, jobId)\n      }\n    }\n    for (const [jobId, job] of Object.entries(jobs)) {\n      vueSet(pendingJobs.value, jobId, job)\n    }\n  } catch (e) {\n    logger.error('ERROR', e)\n    if (isAxiosErrorResponse(e) && e.response.data) {\n      const responseData = e.response.data as { messages?: string[] }\n      if (responseData.messages) {\n        for (const message of responseData.messages) {\n          showError(message, { timeout: TOAST_PERMANENT_TIMEOUT })\n        }\n      }\n    }\n  }\n  if (silent !== true) {\n    --loading.value\n  }\n}\n\nconst cancelPendingOperation = async (operation: 'extract'|'mount') => {\n  const archivePath = encodeURIComponent(fileName.value!)\n  const mountPath = encodeURIComponent(archiveMountPathName.value)\n  const url = generateAppUrl(\n    'archive/schedule/{operation}/{archivePath}/{mountPath}',\n    {\n      operation,\n      archivePath,\n      mountPath,\n    },\n  )\n  let responseData: CancelJobResponse = {}\n  try {\n    const response = await axios.delete<CancelJobResponse>(url, {})\n    responseData = response.data\n  } catch (e) {\n    logger.error('ERROR', e)\n    if (isAxiosErrorResponse(e)) {\n      const messages: string[] = []\n      if (e.response.data) {\n        responseData = e.response.data as CancelJobResponse\n        if (Array.isArray(responseData.messages)) {\n          messages.splice(messages.length, 0, ...responseData.messages)\n        }\n      }\n      if (!messages.length) {\n        messages.push(\n          t(appName, 'Cancelling the background job failed with error {status}, \"{statusText}\".', {\n            status: e.response.status,\n            statusText: e.response.statusText,\n          }),\n        )\n      }\n      for (const message of messages) {\n        showError(message, { timeout: TOAST_PERMANENT_TIMEOUT })\n      }\n    }\n  }\n  if (responseData.removed) {\n    for (const job of responseData.removed) {\n      const jobId = getJobIdFromJob(job)\n      if (pendingJobs.value[jobId]) {\n        vueDel(pendingJobs.value, jobId)\n      }\n    }\n  }\n}\n\nconst getArchiveMounts = async (fileName: string, silent?: boolean) => {\n  const result: Omit<GetArchiveMountResponse, 'messages'> = {\n    mounts: [],\n    mounted: false,\n  }\n  if (silent !== true) {\n    ++loading.value\n  }\n  fileName = encodeURIComponent(fileName)\n  const url = generateAppUrl('archive/mount/{fileName}', { fileName })\n  try {\n    const response = await axios.get<GetArchiveMountResponse>(url)\n    const responseData = response.data\n    result.mounts = responseData.mounts\n    result.mounted = responseData.mounted\n    if (responseData.messages) {\n      for (const message of responseData.messages) {\n        showInfo(message)\n      }\n    }\n  } catch (e) {\n    logger.error('ERROR', e)\n    if (isAxiosErrorResponse(e) && e.response.data) {\n      const responseData = e.response.data as GetArchiveMountResponse\n      result.mounts = responseData.mounts\n      result.mounted = responseData.mounted\n      if (responseData.messages) {\n        for (const message of responseData.messages) {\n          showError(message, { timeout: TOAST_PERMANENT_TIMEOUT })\n        }\n      }\n    }\n  }\n  // id=\"fileList\"\n  // data-path\n  // data-file\n  for (const mount of result.mounts) {\n    // const pathComponents = mount.mountPointPath.split('/')\n    // const baseName = pathComponents.pop()\n    // const dirName = pathComponents.join('/')\n    // mount.baseName = baseName\n    // mount.dirName = dirName\n    if (!archivePassPhrase.value && mount.archivePassPhrase) {\n      archivePassPhrase.value = mount.archivePassPhrase\n    }\n    delete mount.archivePassPhrase\n  }\n  if (silent !== true) {\n    --loading.value\n  }\n  return result\n}\n\nconst mountArchive = async () => {\n  const archivePath = encodeURIComponent(fileName.value!)\n  const mountPath = encodeURIComponent(archiveMountPathName.value)\n  const urlTemplate = archiveMountBackgroundJob.value\n    ? 'archive/schedule/mount/{archivePath}/{mountPath}'\n    : 'archive/mount/{archivePath}/{mountPath}'\n  const url = generateAppUrl(urlTemplate, { archivePath, mountPath })\n  setBusyState(true)\n  const requestData: Record<string, string|boolean> = {}\n  if (archivePassPhrase.value) {\n    requestData.passPhrase = archivePassPhrase.value\n  }\n  requestData.stripCommonPathPrefix = !!archiveMountStripCommonPathPrefix.value\n  try {\n    const response = await axios.post<ArchiveMount>(url, requestData)\n    if (!archiveMountBackgroundJob.value) {\n      const newMount = response.data\n      const newFileId = newMount.mountPoint.fileid\n      if (archiveMounts.value.findIndex((mount) => mount.mountPoint.fileid === newFileId) === -1) {\n        archiveMounts.value.push(newMount)\n        const node = fileInfoToNode(response.data.mountPoint)\n        node.attributes['is-mount-root'] = true\n\n        emit('files:node:created', node)\n      }\n    }\n  } catch (e) {\n    logger.error('ERROR', e)\n    if (isAxiosErrorResponse(e)) {\n      const messages: string[] = []\n      if (e.response.data) {\n        const responseData = e.response.data as { messages?: string[] }\n        if (responseData.messages) {\n          messages.splice(messages.length, 0, ...responseData.messages)\n        }\n      }\n      if (!messages.length) {\n        messages.push(t(appName, 'Mount request failed with error {status}, \"{statusText}\".', {\n          status: e.response.status,\n          statusText: e.response.statusText,\n        }))\n      }\n      for (const message of messages) {\n        showError(message, { timeout: TOAST_PERMANENT_TIMEOUT })\n      }\n    }\n  }\n  if (archiveMountBackgroundJob.value) {\n    getPendingJobs(fileName.value!, true)\n  }\n  setBusyState(false)\n}\n\nconst unmount = async (mount: ArchiveMount) => {\n  const cloudUser = getCurrentUser()\n  const url = generateRemoteUrl('dav/files/' + cloudUser!.uid + mount.mountPointPath)\n  setBusyState(true)\n  try {\n    await axios.delete(url)\n    const mountIndex = archiveMounts.value.indexOf(mount)\n    if (mountIndex >= 0) {\n      archiveMounts.value.splice(mountIndex, 1)\n    } else {\n      logger.error('UNABLE TO FIND DELETED MOUNT IN LIST', mount, archiveMounts)\n    }\n    const node = fileInfoToNode(mount.mountPoint)\n    node.attributes['is-mount-root'] = true\n\n    emit('files:node:deleted', node)\n  } catch (e) {\n    logger.error('ERROR', e)\n    const messages: string[] = []\n    if (isAxiosErrorResponse(e)) {\n      // attempt parsing Sabre exception is available\n      const xml = (e.response.request as XMLHttpRequest)?.responseXML\n      if (xml && xml.documentElement.localName === 'error' && xml.documentElement.namespaceURI === 'DAV:') {\n        const xmlMessages = xml.getElementsByTagNameNS('http://sabredav.org/ns', 'message')\n        // const exceptions = xml.getElementsByTagNameNS('http://sabredav.org/ns', 'exception');\n        for (const message of xmlMessages) {\n          message.textContent && messages.push(message.textContent)\n        }\n      }\n      if (e.response.data) {\n        const responseData = e.response.data as { messages?: string[] }\n        if (responseData.messages) {\n          messages.splice(messages.length, 0, ...responseData.messages)\n        }\n      }\n      if (!messages.length) {\n        messages.push(t(appName, 'Unmount request failed with error {status}, \"{statusText}\".', {\n          status: e.response.status,\n          statusText: e.response.statusText,\n        }))\n      }\n      for (const message of messages) {\n        showError(message, { timeout: TOAST_PERMANENT_TIMEOUT })\n      }\n      if (e.response.status === 404) {\n        refreshArchiveMounts(fileName.value!, true)\n      }\n    }\n  }\n  setBusyState(false)\n}\n\nconst extractArchive = async () => {\n  const archivePath = encodeURIComponent(fileName.value!)\n  const targetPath = encodeURIComponent(archiveExtractPathName.value)\n  const urlTemplate = archiveExtractBackgroundJob.value\n    ? 'archive/schedule/extract/{archivePath}/{targetPath}'\n    : 'archive/extract/{archivePath}/{targetPath}'\n  const url = generateAppUrl(urlTemplate, { archivePath, targetPath })\n  setBusyState(true)\n  const requestData: Record<string, string|boolean> = {}\n  if (archivePassPhrase.value) {\n    requestData.passPhrase = archivePassPhrase.value\n  }\n  requestData.stripCommonPathPrefix = !!archiveExtractStripCommonPathPrefix.value\n  try {\n    const response = await axios.post<{ targetFolder: FileInfoDTO }>(url, requestData)\n    if (!archiveExtractBackgroundJob.value) {\n      const node = fileInfoToNode(response.data.targetFolder)\n      node.attributes['is-mount-root'] = true\n\n      emit('files:node:created', node)\n    }\n  } catch (e) {\n    logger.error('ERROR', e)\n    if (isAxiosErrorResponse(e)) {\n      const messages: string[] = []\n      if (e.response.data) {\n        const responseData = e.response.data as { messages?: string[] }\n        if (responseData.messages) {\n          messages.splice(messages.length, 0, ...responseData.messages)\n        }\n      }\n      if (!messages.length) {\n        messages.push(t(appName, 'Archive extraction failed with error {status}, \"{statusText}\".', {\n          status: e.response.status,\n          statusText: e.response.statusText,\n        }))\n      }\n      for (const message of messages) {\n        showError(message, { timeout: TOAST_PERMANENT_TIMEOUT })\n      }\n    }\n  }\n  if (archiveExtractBackgroundJob.value) {\n    getPendingJobs(fileName.value!, true)\n  }\n  setBusyState(false)\n}\n\nconst setPassPhrase = async () => {\n  const newPassPhrase: string = showArchivePassPhrase.value\n    ? archivePassPhraseComponent.value!.$el.querySelector<HTMLInputElement>('input[type=\"text\"]')?.value || ''\n    : archivePassPhraseComponent.value!.$el.querySelector<HTMLInputElement>('input[type=\"password\"]')?.value || ''\n  archivePassPhrase.value = newPassPhrase\n\n  // patch it into existing mounts if any\n  const archivePath = encodeURIComponent(fileName.value!)\n  const url = generateUrl('/apps/' + appName + '/archive/mount/{archivePath}', { archivePath })\n  setBusyState(true)\n  const requestData = {\n    changeSet: {\n      archivePassPhrase: archivePassPhrase.value,\n    },\n  }\n  try {\n    await axios.patch(url, requestData)\n  } catch (e) {\n    logger.error('ERROR', e)\n    if (isAxiosErrorResponse(e)) {\n      const messages: string[] = []\n      if (e.response.data) {\n        const responseData = e.response.data as { messages?: string[] }\n        if (responseData.messages) {\n          messages.splice(messages.length, 0, ...responseData.messages)\n        }\n      }\n      if (!messages.length) {\n        messages.push(t(appName, 'Patching the passphrase failed with error {status}, \"{statusText}\".', {\n          status: e.response.status,\n          statusText: e.response.statusText,\n        }))\n      }\n      for (const message of messages) {\n        showError(message, { timeout: TOAST_PERMANENT_TIMEOUT })\n      }\n    }\n  }\n  setBusyState(false)\n}\n\nconst togglePassPhraseVisibility = async () => {\n  // this is sooo complicated because the NC NcAction controls are\n  // seemingly only pro-forma vue-controls. There is no working\n  // v-model support, e.g.\n  let visibleElement = showArchivePassPhrase.value\n    ? archivePassPhraseComponent.value!.$el.querySelector<HTMLInputElement>('input[type=\"text\"]')!\n    : archivePassPhraseComponent.value!.$el.querySelector<HTMLInputElement>('input[type=\"password\"]')!\n  const currentValue: string = visibleElement.value\n\n  showArchivePassPhrase.value = !showArchivePassPhrase.value\n  await nextTick()\n\n  visibleElement = showArchivePassPhrase.value\n    ? archivePassPhraseComponent.value!.$el.querySelector<HTMLInputElement>('input[type=\"text\"]')!\n    : archivePassPhraseComponent.value!.$el.querySelector<HTMLInputElement>('input[type=\"password\"]')!\n  visibleElement.value = currentValue\n}\n\nconst filesAppMountPointUrl = (mountPoint: ArchiveMount) => {\n  return generateUrl('/apps/files') + '?dir=' + encodeURIComponent(mountPoint.mountPointPath)\n}\n\nconst onNotification = (event: NextcloudEvents['notifications:notification:received']) => {\n  if (event?.notification?.app !== appName) {\n    return\n  }\n  const destinationData = event?.notification?.messageRichParameters?.destination\n  if (destinationData?.status !== 'mount') {\n    return // nothing special ATM\n  }\n  const mountData = destinationData?.mount\n  if (!mountData) {\n    logger.error('No mount info in mount notification event')\n    return\n  }\n  let mount: ArchiveMountEntity\n  try {\n    mount = JSON.parse(mountData)\n  } catch (error) {\n    logger.error('files_archive, unable to decode mount entity', { event, mountData })\n    return\n  }\n  if (mount.archiveFileId !== archiveFileId.value) {\n    // not for us, in the future we may want to maintain a store\n    // and cache the data for all file-ids.\n    logger.info('*** Archive notification for other file received', event)\n    return\n  }\n  const jobId = getJobIdFromOperation('mount', mount.archiveFilePath, mount.mountPointPath)\n  if (pendingJobs.value[jobId]) {\n    delete pendingJobs.value[jobId]\n  }\n  logger.info('*** Mount notification received, updating mount-list', destinationData)\n  const mountFileId = destinationData.id\n  const mountIndex = archiveMounts.value.findIndex((mount) => mount.mountPoint.fileid === mountFileId)\n  if (mountIndex === -1) {\n    try {\n      archiveMounts.value.push({ ...mount, mountPoint: JSON.parse(destinationData.folder) })\n    } catch (error) {\n      logger.error('Unable to decode mount point folder file-info record.', { destinationData })\n    }\n  }\n}\n\nconst onMountPointRenamed = (mountPoint: Node) => {\n  // update the list of mountpoints\n  const mountFileId = mountPoint.fileid\n  const mountIndex = archiveMounts.value.findIndex((mount) => mount.mountPoint.fileid === mountFileId)\n  if (mountIndex >= 0) {\n    logger.info('BERFORE RENAME', { ...archiveMounts[mountIndex] })\n    vueSet(archiveMounts[mountIndex], 'mountPoint', mountPoint)\n    vueSet(archiveMounts[mountIndex], 'mountPointPath', mountPoint.path)\n    vueSet(archiveMounts[mountIndex], 'mountPointPathHash', md5(mountPoint.path))\n    logger.info('AFTER RENAME', { ...archiveMounts[mountIndex] })\n  } else {\n    logger.info('RENAME OF NODE NOT FOR US', mountPoint)\n  }\n}\n\nconst onMountPointDeleted = (mountPoint: Node) => {\n  const mountFileId = mountPoint.fileid\n  const mountIndex = archiveMounts.value.findIndex((mount) => mount.mountPoint.fileid === mountFileId)\n  if (mountIndex >= 0) {\n    archiveMounts.value.splice(mountIndex, 1)\n    logger.info('RECORD UNMOUNT', mountPoint)\n  } else {\n    logger.info('DELETE OF NODE NOT FOR US', {\n      mountPoint,\n      archiveMounts: archiveMounts.value,\n    })\n  }\n}\n\nonBeforeMount(() => {\n  subscribe('files:node:deleted', onMountPointDeleted)\n  subscribe('files:node:renamed', onMountPointRenamed)\n  subscribe('notifications:notification:received', onNotification)\n})\n\nonUnmounted(() => {\n  unsubscribe('files:node:deleted', onMountPointDeleted)\n  unsubscribe('files:node:renamed', onMountPointRenamed)\n  unsubscribe('notifications:notification:received', onNotification)\n})\n\n\nreturn { __sfc: true,archivePassPhraseComponent, mountOptionsComponent, extractionOptionsComponent, loading, fileInfo, fileName, archiveFileId, ArchiveStatusOk, ArchiveStatusTooLarge, ArchiveStatusBomb, archiveInfo, archiveStatus, archiveMounts, pendingJobs, jobsArePending, initialState, archiveMountStripCommonPathPrefix, archiveExtractStripCommonPathPrefix, archiveMountBackgroundJob, archiveExtractBackgroundJob, archivePassPhrase, showArchiveInfo, showArchivePassPhrase, showArchiveMounts, showArchiveExtraction, showPendingJobs, openMountTarget, archiveMountFileInfo, archiveExtractFileInfo, archiveMountBaseName, archiveMountDirName, archiveExtractBaseName, archiveExtractDirName, archiveMountPathName, archiveExtractPathName, archiveStatusText, archiveMounted, humanArchiveOriginalSize, humanArchiveCompressedSize, humanArchiveFileSize, numberOfArchiveMembers, commonPathPrefix, isLt, openMountOptionsMenu, openExtractionOptionsMenu, getData, update, getArchiveInfo, refreshArchiveMounts, getJobIdFromOperation, getJobIdFromJob, getPendingJobs, cancelPendingOperation, getArchiveMounts, mountArchive, unmount, extractArchive, setPassPhrase, togglePassPhraseVisibility, filesAppMountPointUrl, onNotification, onMountPointRenamed, onMountPointDeleted, appName, t, NetworkOffIcon, CancelIcon, NcActionInput, NcActionCheckbox, NcActions, NcActionButton, NcListItem, FilePrefixPicker }\n}\n\n})","import mod from \"-!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??clonedRuleSet-6.use[1]!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./FilesTab.vue?vue&type=script&setup=true&lang=ts\"; export default mod; export * from \"-!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??clonedRuleSet-6.use[1]!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./FilesTab.vue?vue&type=script&setup=true&lang=ts\"","<!--\n  - @author Claus-Justus Heine <himself@claus-justus-heine.de>\n  - @copyright 2022, 2023, 2024, 2025 Claus-Justus Heine\n  - @license AGPL-3.0-or-later\n  -\n  - This program is free software: you can redistribute it and/or modify\n  - it under the terms of the GNU Affero General Public License as\n  - published by the Free Software Foundation, either version 3 of the\n  - License, or (at your option) any later version.\n  -\n  - This program is distributed in the hope that it will be useful,\n  - but WITHOUT ANY WARRANTY; without even the implied warranty of\n  - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n  - GNU Affero General Public License for more details.\n  -\n  - You should have received a copy of the GNU Affero General Public License\n  - along with this program. If not, see <http://www.gnu.org/licenses/>.\n  -\n  -->\n<template>\n  <div class=\"files-tab\">\n    <ul>\n      <li class=\"files-tab-entry flex flex-center clickable\"\n          @click=\"showArchiveInfo = !showArchiveInfo\"\n      >\n        <div class=\"files-tab-entry__avatar icon-info-white\" />\n        <div class=\"files-tab-entry__desc\">\n          <h5>{{ t(appName, 'Archive Information') }}</h5>\n        </div>\n        <NcActions>\n          <NcActionButton v-model=\"showArchiveInfo\"\n                          :icon=\"'icon-triangle-' + (showArchiveInfo ? 'n' : 's')\"\n          />\n        </NcActions>\n      </li>\n      <li v-show=\"showArchiveInfo\" class=\"files-tab-entry\">\n        <div v-if=\"loading\" class=\"icon-loading-small\" />\n        <ul v-show=\"!loading\" class=\"archive-info\">\n          <NcListItem v-if=\"isLt(0, archiveStatus)\"\n                      :class=\"{ 'archive-error': isLt(0, archiveStatus) }\"\n                      :name=\"t(appName, 'archive status')\"\n                      :bold=\"true\"\n                      :details=\"archiveStatusText\"\n          >\n            <template #icon>\n              <div class=\"icon-error\" />\n            </template>\n          </NcListItem>\n          <NcListItem :name=\"t(appName, 'archive format')\"\n                      :bold=\"true\"\n                      :details=\"archiveInfo?.format || t(appName, 'unknown')\"\n                      compact\n          />\n          <NcListItem :name=\"t(appName, 'MIME type')\"\n                      :bold=\"true\"\n                      :details=\"archiveInfo?.mimeType || t(appName, 'unknown')\"\n                      compact\n          />\n          <NcListItem :name=\"t(appName, 'backend driver')\"\n                      :bold=\"true\"\n                      :details=\"archiveInfo?.backendDriver || t(appName, 'unknown')\"\n                      compact\n          />\n          <NcListItem :name=\"t(appName, 'uncompressed size')\"\n                      :bold=\"true\"\n                      :details=\"humanArchiveOriginalSize\"\n                      compact\n          />\n          <NcListItem :name=\"t(appName, 'compressed size')\"\n                      :bold=\"true\"\n                      :details=\"humanArchiveCompressedSize\"\n                      compact\n          />\n          <NcListItem v-if=\"humanArchiveCompressedSize !== humanArchiveFileSize\"\n                      :name=\"t(appName, 'archive file size')\"\n                      :bold=\"true\"\n                      :details=\"humanArchiveFileSize\"\n                      compact\n          />\n          <NcListItem :name=\"t(appName, '# archive members')\"\n                      :bold=\"true\"\n                      :details=\"numberOfArchiveMembers\"\n                      compact\n          />\n          <NcListItem :name=\"t(appName, 'common prefix')\"\n                      :bold=\"true\"\n                      :details=\"commonPathPrefix\"\n                      compact\n          />\n          <NcListItem v-if=\"archiveInfo?.comment\"\n                      class=\"archive-comment\"\n                      :name=\"t(appName, 'creator\\'s comment')\"\n                      :bold=\"true\"\n                      compact\n          >\n            <template #subtitle>\n              {{ archiveInfo?.comment }}\n            </template>\n          </NcListItem>\n        </ul>\n      </li>\n      <li class=\"files-tab-entry flex flex-center\">\n        <div class=\"files-tab-entry__avatar icon-password-white\" />\n        <div class=\"files-tab-entry__desc\">\n          <h5>\n            <span class=\"main-title\">{{ t(appName, 'Passphrase') }}</span>\n            <span v-if=\"!archivePassPhrase\" class=\"title-annotation\">({{ t(appName, 'unset') }})</span>\n          </h5>\n        </div>\n        <NcActions :force-menu=\"true\">\n          <NcActionInput v-if=\"showArchivePassPhrase\"\n                         ref=\"archivePassPhraseComponent\"\n                         :value=\"archivePassPhrase\"\n                         type=\"text\"\n                         icon=\"icon-password\"\n                         @submit=\"setPassPhrase\"\n          >\n            {{ t(appName, 'archive passphrase') }}\n          </NcActionInput>\n          <NcActionInput v-else\n                         ref=\"archivePassPhraseComponent\"\n                         :value=\"archivePassPhrase\"\n                         type=\"password\"\n                         icon=\"icon-password\"\n                         @submit=\"setPassPhrase\"\n          >\n            {{ t(appName, 'archive passphrase') }}\n          </NcActionInput>\n          <NcActionCheckbox @change=\"togglePassPhraseVisibility\">\n            {{ t(appName, 'Show Passphrase') }}\n          </NcActionCheckbox>\n        </NcActions>\n      </li>\n      <li class=\"files-tab-entry flex flex-center clickable\"\n          @click=\"showArchiveMounts = !showArchiveMounts\"\n      >\n        <div class=\"files-tab-entry__avatar icon-external-white\" />\n        <div class=\"files-tab-entry__desc\">\n          <h5>\n            <span class=\"main-title\">{{ t(appName, 'Mount Points') }}</span>\n            <span v-if=\"archiveMounted\" class=\"title-annotation\">({{ '' + archiveMounts.length }})</span>\n            <span v-else class=\"title-annotation\">({{ t(appName, 'not mounted') }})</span>\n          </h5>\n        </div>\n        <NcActions>\n          <NcActionButton v-model=\"showArchiveMounts\"\n                          :icon=\"'icon-triangle-' + (showArchiveMounts ? 'n' : 's')\"\n          />\n        </NcActions>\n      </li>\n      <li v-show=\"showArchiveMounts\" class=\"directory-chooser files-tab-entry\">\n        <div v-if=\"loading\" class=\"icon-loading-small\" />\n        <ul v-else-if=\"archiveMounted\" class=\"archive-mounts\">\n          <NcListItem v-for=\"mountPoint in archiveMounts\"\n                      :key=\"mountPoint.id\"\n                      :force-display-actions=\"true\"\n                      :bold=\"false\"\n          >\n            <template #title>\n              <a v-tooltip=\"mountPoint.mountPointPath\"\n                 class=\"external icon-folder icon\"\n                 :target=\"openMountTarget\"\n                 :href=\"filesAppMountPointUrl(mountPoint)\"\n              >\n                {{ mountPoint.mountPointPath }}\n              </a>\n            </template>\n            <template #actions>\n              <NcActionButton @click=\"unmount(mountPoint)\">\n                <template #icon>\n                  <NetworkOffIcon v-tooltip=\"t(appName, 'Disconnect storage')\"\n                                  :size=\"20\"\n                  />\n                </template>\n              </NcActionButton>\n            </template>\n            <template v-if=\"mountPoint.mountFlags & 1\" #extra>\n              <div>{{ t(appName, 'Common prefix {prefix} is stripped.', { prefix: commonPathPrefix }) }}</div>\n            </template>\n          </NcListItem>\n        </ul>\n        <div v-else>\n          <FilePrefixPicker v-model=\"archiveMountFileInfo\"\n                            :hint=\"t(appName, 'Not mounted, create a new mount point:')\"\n                            :placeholder=\"t(appName, 'base name')\"\n                            @submit=\"mountArchive\"\n          />\n          <div class=\"flex flex-center\">\n            <div class=\"label\"\n                 @click=\"openMountOptionsMenu\"\n            >\n              {{ t(appName, 'Mount Options') }}\n            </div>\n            <NcActions ref=\"mountOptionsComponent\"\n                       :force-menu=\"true\"\n            >\n              <NcActionCheckbox ref=\"mountStripCommonPathPrefixComponent\"\n                                :checked=\"archiveMountStripCommonPathPrefix\"\n                                @change=\"archiveMountStripCommonPathPrefix = !archiveMountStripCommonPathPrefix\"\n              >\n                {{ t(appName, 'strip common path prefix') }}\n              </NcActionCheckbox>\n              <NcActionCheckbox ref=\"mountBackgroundJobComponent\"\n                                :checked=\"archiveMountBackgroundJob\"\n                                @change=\"archiveMountBackgroundJob = !archiveMountBackgroundJob\"\n              >\n                {{ t(appName, 'schedule as background job') }}\n              </NcActionCheckbox>\n            </NcActions>\n          </div>\n        </div>\n      </li>\n      <li class=\"files-tab-entry flex flex-center clickable\"\n          @click=\"showArchiveExtraction = !showArchiveExtraction\"\n      >\n        <div class=\"files-tab-entry__avatar icon-play-white\" />\n        <div class=\"files-tab-entry__desc\">\n          <h5>{{ t(appName, 'Extract Archive') }}</h5>\n        </div>\n        <NcActions>\n          <NcActionButton v-model=\"showArchiveExtraction\"\n                          :icon=\"'icon-triangle-' + (showArchiveExtraction ? 'n' : 's')\"\n          />\n        </NcActions>\n      </li>\n      <li v-show=\"showArchiveExtraction\" class=\"directory-chooser files-tab-entry\">\n        <div v-if=\"loading\" class=\"icon-loading-small\" />\n        <div v-else>\n          <FilePrefixPicker v-model=\"archiveExtractFileInfo\"\n                            :hint=\"t(appName, 'Choose a directory to extract the archive to:')\"\n                            :placeholder=\"t(appName, 'basename')\"\n                            @submit=\"extractArchive\"\n          />\n          <div class=\"flex flex-center\">\n            <div class=\"label\"\n                 @click=\"openExtractionOptionsMenu\"\n            >\n              {{ t(appName, 'Extraction Options') }}\n            </div>\n            <NcActions ref=\"extractionOptionsComponent\"\n                       :force-menu=\"true\"\n            >\n              <NcActionCheckbox :checked=\"archiveExtractStripCommonPathPrefix\"\n                                @change=\"archiveExtractStripCommonPathPrefix = !archiveExtractStripCommonPathPrefix\"\n              >\n                {{ t(appName, 'strip common path prefix') }}\n              </NcActionCheckbox>\n              <NcActionCheckbox ref=\"extractBackgroundJobComponent\"\n                                :checked=\"archiveExtractBackgroundJob\"\n                                @change=\"archiveExtractBackgroundJob = !archiveExtractBackgroundJob\"\n              >\n                {{ t(appName, 'schedule as background job') }}\n              </NcActionCheckbox>\n            </NcActions>\n          </div>\n        </div>\n      </li>\n      <li class=\"files-tab-entry flex flex-center clickable\"\n          @click=\"showPendingJobs = !showPendingJobs\"\n      >\n        <div class=\"files-tab-entry__avatar icon-recent-white\" />\n        <div class=\"files-tab-entry__desc\">\n          <h5 v-if=\"jobsArePending\">\n            <span class=\"main-title\">{{ t(appName, 'Pending Background Jobs') }}</span>\n            <span v-if=\"jobsArePending\" class=\"title-annotation\">({{ '' + Object.keys(pendingJobs).length }})</span>\n          </h5>\n          <h5 v-else>\n            <span class=\"main-title\">{{ t(appName, 'No Pending Background Jobs') }}</span>\n          </h5>\n        </div>\n        <NcActions>\n          <NcActionButton v-model=\"showPendingJobs\"\n                          :icon=\"'icon-triangle-' + (showPendingJobs ? 'n' : 's')\"\n          />\n        </NcActions>\n      </li>\n      <li v-show=\"jobsArePending && showPendingJobs\" class=\"directory-chooser files-tab-entry\">\n        <div v-if=\"loading\" class=\"icon-loading-small\" />\n        <ul v-else-if=\"jobsArePending\" class=\"pending-jobs\">\n          <NcListItem v-for=\"job in pendingJobs\"\n                      :key=\"job.destinationPath\"\n                      :force-display-actions=\"true\"\n                      :bold=\"false\"\n          >\n            <template #title>\n              <div>{{ job.destinationPath }}</div>\n            </template>\n            <template #actions>\n              <NcActionButton @click=\"cancelPendingOperation(job.target)\">\n                <template #icon>\n                  <CancelIcon v-tooltip=\"t(appName, 'Cancel Job')\"\n                              :size=\"20\"\n                  />\n                </template>\n              </NcActionButton>\n            </template>\n            <template v-if=\"job.stripCommonPathPrefix\" #extra>\n              <div>{{ t(appName, 'Job type: {type}', {type: job.target === 'mount' ? t(appName, 'mount') : t(appName, 'extract')}) }}</div>\n              <div>{{ t(appName, 'Common prefix {prefix} will be stripped.', { prefix: commonPathPrefix }) }}</div>\n            </template>\n          </NcListItem>\n        </ul>\n        <div v-else>\n          {{ t(appName, 'No pending background job.') }}\n        </div>\n      </li>\n    </ul>\n  </div>\n</template>\n<script setup lang=\"ts\">\nimport { appName } from '../config.ts'\nimport {\n  computed,\n  reactive,\n  ref,\n  set as vueSet,\n  del as vueDel,\n  onBeforeMount,\n  onUnmounted,\n  nextTick,\n} from 'vue'\nimport getInitialState from '../toolkit/util/initial-state.ts'\nimport { generateUrl, generateRemoteUrl } from '@nextcloud/router'\nimport { emit, subscribe, unsubscribe } from '@nextcloud/event-bus'\nimport { getCurrentUser } from '@nextcloud/auth'\nimport generateAppUrl from '../toolkit/util/generate-url.ts'\nimport { fileInfoToNode } from '../toolkit/util/file-node-helper.ts'\nimport type { FileInfoDTO } from '../toolkit/util/file-node-helper.ts'\nimport { md5 } from 'js-md5'\nimport { showError, showInfo, TOAST_PERMANENT_TIMEOUT } from '@nextcloud/dialogs'\nimport { translate as t } from '@nextcloud/l10n'\nimport NetworkOffIcon from 'vue-material-design-icons/NetworkOff.vue'\nimport CancelIcon from 'vue-material-design-icons/Cancel.vue'\nimport { formatFileSize } from '@nextcloud/files'\nimport {\n  NcActionInput,\n  NcActionCheckbox,\n  NcActions,\n  NcActionButton,\n  NcListItem,\n} from '@nextcloud/vue'\nimport FilePrefixPicker from '@rotdrop/nextcloud-vue-components/lib/components/FilePrefixPicker.vue'\nimport axios from '@nextcloud/axios'\nimport type { LegacyFileInfo, Node } from '@nextcloud/files'\nimport { isAxiosErrorResponse } from '../toolkit/types/axios-type-guards.ts'\nimport type { NextcloudEvents } from '@nextcloud/event-bus'\nimport type {\n  ArchiveMount,\n  ArchiveMountEntity,\n  GetArchiveMountResponse,\n} from '../model/archive-mount.d.ts'\nimport { setSidebarNodeBusy as setBusyState } from '../toolkit/util/nextcloud-sidebar-root.ts'\nimport logger from '../console.ts'\nimport type { InitialState } from '../types/initial-state.d.ts'\n\ninterface ArchiveInfo {\n  commonPathPrefix: string,\n  compressedSize: number,\n  defaultMountPoint: string,\n  defaultTargetBaseName: string,\n  numberOfFiles: number,\n  originalSize: number,\n  size: number,\n  format: string,\n  mimeType: string,\n  backendDriver: string,\n  comment?: string,\n}\n\ninterface ArchiveJob {\n  target: 'mount'|'extract',\n  userId: string,\n  sourceId: number,\n  sourcePath: string,\n  destinationPath: string,\n  archivePassphrase?: string,\n  stripCommonPathPrefix: boolean,\n  needsAuthentication: boolean,\n  authToken: string,\n}\n\nsetBusyState(false) // needs to be done once while in setup mode\n\nconst archivePassPhraseComponent = ref<null|typeof NcActionInput>(null)\nconst mountOptionsComponent = ref<null|typeof NcActions>(null)\nconst extractionOptionsComponent = ref<null|typeof NcActions>(null)\n\nconst loading = ref(0)\n\nconst fileInfo = ref<undefined|LegacyFileInfo>(undefined)\nconst fileName = computed(() => fileInfo.value ? fileInfo.value.path + '/' + fileInfo.value.name : null)\nconst archiveFileId = computed(() => fileInfo.value?.id)\n\nconst ArchiveStatusOk = 0\nconst ArchiveStatusTooLarge = 1\nconst ArchiveStatusBomb = 2\n\nconst archiveInfo = ref<undefined|ArchiveInfo>(undefined)\nconst archiveStatus = ref<undefined|number>(undefined)\n\nconst archiveMounts = ref<ArchiveMount[]>([])\n\nconst pendingJobs = ref<Record<string, ArchiveJob> >({})\nconst jobsArePending = computed(() => Object.keys(pendingJobs.value).length > 0)\n\nconst initialState = getInitialState<InitialState>()\n\nconst archiveMountStripCommonPathPrefix = ref(!!initialState?.mountStripCommonPathPrefixDefault)\nconst archiveExtractStripCommonPathPrefix = ref(!!initialState?.extractStripCommonPathPrefixDefault)\nconst archiveMountBackgroundJob = ref(!!initialState?.mountBackgroundJob)\nconst archiveExtractBackgroundJob = ref(!!initialState?.extractBackgroundJob)\nconst archivePassPhrase = ref<undefined|string>(undefined)\n\nconst showArchiveInfo = ref(true)\nconst showArchivePassPhrase = ref(false)\nconst showArchiveMounts = ref(false)\nconst showArchiveExtraction = ref(false)\nconst showPendingJobs = ref(false)\nconst openMountTarget = computed(() => md5(generateUrl('') + appName + '-open-archive-mount'))\n\nconst archiveMountFileInfo = reactive({\n  dirName: '',\n  baseName: '',\n})\n\nconst archiveExtractFileInfo = reactive({\n  dirName: '',\n  baseName: '',\n})\n\nconst archiveMountBaseName = computed({\n  get() {\n    return archiveMountFileInfo.baseName\n  },\n  set(value) {\n    vueSet(archiveMountFileInfo, 'baseName', value)\n    return value\n  },\n})\n\nconst archiveMountDirName = computed({\n  get() {\n    return archiveMountFileInfo.dirName\n  },\n  set(value) {\n    vueSet(archiveMountFileInfo, 'dirName', value)\n    return value\n  },\n})\n\nconst archiveExtractBaseName = computed({\n  get() {\n    return archiveExtractFileInfo.baseName\n  },\n  set(value) {\n    vueSet(archiveExtractFileInfo, 'baseName', value)\n    return value\n  },\n})\n\nconst archiveExtractDirName = computed({\n  get() {\n    return archiveExtractFileInfo.dirName\n  },\n  set(value) {\n    vueSet(archiveExtractFileInfo, 'dirName', value)\n    return value\n  },\n})\n\nconst archiveMountPathName = computed(() => archiveMountDirName.value + (archiveMountBaseName.value ? '/' + archiveMountBaseName.value : ''))\nconst archiveExtractPathName = computed(() => archiveExtractDirName.value + (archiveExtractBaseName.value ? '/' + archiveExtractBaseName.value : ''))\n\nconst archiveStatusText = computed(() => {\n  if (archiveStatus.value! === ArchiveStatusOk) {\n    return t(appName, 'ok')\n  } else if (archiveStatus.value! & ArchiveStatusBomb) {\n    return t(appName, 'zip bomb')\n  } else if (archiveStatus.value! & ArchiveStatusTooLarge) {\n    return t(appName, 'too large')\n  }\n  return t(appName, 'unknown')\n})\n\n// const archiveFileDirName = computed(() => fileInfo.value?.path)\n// const archiveFileBaseName = computed(() => fileInfo.value?.name)\n// const archiveFilePathName = computed(() => fileInfo.value?.path + '/' + fileInfo.value?.name)\nconst archiveMounted = computed(() => archiveMounts.value.length > 0)\n// const archiveInfoText = computed(() => JSON.stringify(archiveInfo.value, null, 2))\nconst humanArchiveOriginalSize = computed(() =>\n  !isNaN(parseInt('' + archiveInfo.value?.originalSize))\n    ? formatFileSize(archiveInfo.value!.originalSize)\n    : t(appName, 'unknown'),\n)\nconst humanArchiveCompressedSize = computed(() =>\n  !isNaN(parseInt('' + archiveInfo.value?.compressedSize))\n    ? formatFileSize(archiveInfo.value!.compressedSize)\n    : t(appName, 'unknown'),\n)\nconst humanArchiveFileSize = computed(() =>\n  !isNaN(parseInt('' + archiveInfo.value?.size))\n    ? formatFileSize(archiveInfo.value!.size)\n    : t(appName, 'unknown'),\n)\nconst numberOfArchiveMembers = computed(() => {\n  if (!archiveInfo.value\n      || archiveInfo.value?.numberOfFiles === undefined\n      || isNaN(parseInt('' + archiveInfo.value?.numberOfFiles))) {\n    return t(appName, 'unknown')\n  }\n  return '' + archiveInfo.value?.numberOfFiles\n})\nconst commonPathPrefix = computed(() =>\n  !archiveInfo.value\n    || archiveInfo.value.commonPathPrefix === undefined\n    ? t(appName, 'unknown')\n    : '/' + archiveInfo.value.commonPathPrefix,\n)\n// const mountPointTitle = computed(() =>\n//   t(appName, 'Mount Points')\n//     + ' ('\n//     + (archiveMounted ? archiveMounts.value.length : t(appName, 'not mounted'))\n//     + ')'\n// )\n\n// We ____DO____  want to compare numerically here.\nconst isLt = (a: null|undefined|number, b: null|undefined|number) => a! < b!\n\nconst openMountOptionsMenu = () => {\n  mountOptionsComponent.value?.openMenu()\n}\n\nconst openExtractionOptionsMenu = () => {\n  extractionOptionsComponent.value?.openMenu()\n}\n\n/**\n * Fetch some needed data ...\n */\nconst getData = async () => {\n  archiveMountStripCommonPathPrefix.value = !!initialState?.mountStripCommonPathPrefixDefault\n  archiveExtractStripCommonPathPrefix.value = !!initialState?.extractStripCommonPathPrefixDefault\n  archiveMountBackgroundJob.value = !!initialState?.mountBackgroundJob\n  archiveExtractBackgroundJob.value = !!initialState?.extractBackgroundJob\n\n  if (!fileName.value) {\n    return\n  }\n\n  getArchiveInfo(fileName.value)\n  refreshArchiveMounts(fileName.value, true)\n  getPendingJobs(fileName.value, true)\n}\n\n/**\n * Update current fileInfo and fetch new data\n * @param newFileInfo the current file FileInfo\n */\nconst update = async (newFileInfo: LegacyFileInfo) => {\n  fileInfo.value = newFileInfo\n\n  /* this.fileList = OCA.Files.App.currentFileList\n   * this.fileList.$el.off('updated').on('updated', function(event) {\n   *   logger.info('FILE LIST UPDATED, ARGS', arguments)\n   * }) */\n  archiveMountBaseName.value = fileInfo.value.name.split('.')[0]\n  archiveMountDirName.value = fileInfo.value.path\n\n  archiveExtractBaseName.value = archiveMountBaseName.value\n  archiveExtractDirName.value = archiveMountDirName.value\n\n  getData()\n}\n\ndefineExpose({ update })\n\ninterface ArchiveInfoResponse {\n  messages: string[],\n  archiveStatus: number, //\n  archiveInfo: ArchiveInfo,\n}\n\nconst getArchiveInfo = async (fileName: string) => {\n  ++loading.value\n  fileName = encodeURIComponent(fileName)\n  const url = generateAppUrl('archive/info/{fileName}', { fileName })\n  const requestData: Record<string, string> = {}\n  if (archivePassPhrase.value) {\n    requestData.passPhrase = archivePassPhrase.value\n  }\n  try {\n    const response = await axios.post<ArchiveInfoResponse>(url, requestData)\n    const responseData = response.data\n    archiveInfo.value = responseData.archiveInfo\n    archiveStatus.value = responseData.archiveStatus\n    if (responseData.messages) {\n      for (const message of responseData.messages) {\n        showInfo(message)\n      }\n    }\n  } catch (e) {\n    logger.error('ERROR', e)\n    if (isAxiosErrorResponse(e) && e.response.data) {\n      const responseData = e.response.data as ArchiveInfoResponse\n      archiveInfo.value = responseData.archiveInfo\n      archiveStatus.value = responseData.archiveStatus\n      if (responseData.messages) {\n        for (const message of responseData.messages) {\n          showError(message, { timeout: TOAST_PERMANENT_TIMEOUT })\n        }\n      }\n    } else {\n      archiveInfo.value = undefined\n    }\n  }\n  if (archiveInfo.value?.defaultMountPoint) {\n    archiveMountBaseName.value = archiveInfo.value.defaultMountPoint\n  }\n  if (archiveInfo.value?.defaultTargetBaseName) {\n    archiveExtractBaseName.value = archiveInfo.value.defaultTargetBaseName\n  }\n  --loading.value\n}\n\nconst refreshArchiveMounts = async (filename: string, noEmit?: boolean) => {\n  const oldMounts = [...archiveMounts.value]\n  const mounts = await getArchiveMounts(filename, false)\n  archiveMounts.value = mounts.mounts\n  if (noEmit) {\n    // do no emit birth during initialization\n    return\n  }\n  // emit birth and death signals as needed, in order to update\n  // the frontend file-listing. The computational effort is\n  // quadratic, but we are talking here about the common case that\n  // there is only a single mount -- or by accident another\n  // one. So what.\n  const newMounts = archiveMounts.value.filter((mount) => oldMounts.findIndex((oldMount) => mount.mountPoint.fileid === oldMount.mountPoint.fileid) === -1)\n  const deletedMounts = oldMounts.filter((oldMount) => archiveMounts.value.findIndex((mount) => mount.mountPoint.fileid === oldMount.mountPoint.fileid) === -1)\n  for (const mount of deletedMounts) {\n    const node = fileInfoToNode(mount.mountPoint)\n    node.attributes['is-mount-root'] = true\n\n    emit('files:node:deleted', node)\n  }\n  for (const mount of newMounts) {\n    const node = fileInfoToNode(mount.mountPoint)\n    node.attributes['is-mount-root'] = true\n\n    emit('files:node:created', node)\n  }\n}\n\nconst getJobIdFromOperation = (operation: string, archivePath: string, mountPath: string) => {\n  return md5(operation + archivePath + mountPath)\n}\n\nconst getJobIdFromJob = (job: ArchiveJob) => {\n  return getJobIdFromOperation(job.target, job.sourcePath, job.destinationPath)\n}\n\nconst getPendingJobs = async (fileName: string, silent?: boolean) => {\n  if (silent !== true) {\n    ++loading.value\n  }\n  fileName = encodeURIComponent(fileName)\n  const url = generateAppUrl('archive/schedule/{operation}/{fileName}', { operation: 'status', fileName })\n  try {\n    const response = await axios.get<ArchiveJob[]>(url)\n    const responseData = response.data\n    const jobs = {}\n    for (const job of responseData) {\n      jobs[getJobIdFromJob(job)] = job\n    }\n    for (const jobId of Object.keys(pendingJobs.value)) {\n      if (!jobs[jobId]) {\n        vueDel(pendingJobs.value, jobId)\n      }\n    }\n    for (const [jobId, job] of Object.entries(jobs)) {\n      vueSet(pendingJobs.value, jobId, job)\n    }\n  } catch (e) {\n    logger.error('ERROR', e)\n    if (isAxiosErrorResponse(e) && e.response.data) {\n      const responseData = e.response.data as { messages?: string[] }\n      if (responseData.messages) {\n        for (const message of responseData.messages) {\n          showError(message, { timeout: TOAST_PERMANENT_TIMEOUT })\n        }\n      }\n    }\n  }\n  if (silent !== true) {\n    --loading.value\n  }\n}\n\ninterface CancelJobResponse {\n  removed?: ArchiveJob[],\n  messages?: string[],\n}\n\nconst cancelPendingOperation = async (operation: 'extract'|'mount') => {\n  const archivePath = encodeURIComponent(fileName.value!)\n  const mountPath = encodeURIComponent(archiveMountPathName.value)\n  const url = generateAppUrl(\n    'archive/schedule/{operation}/{archivePath}/{mountPath}',\n    {\n      operation,\n      archivePath,\n      mountPath,\n    },\n  )\n  let responseData: CancelJobResponse = {}\n  try {\n    const response = await axios.delete<CancelJobResponse>(url, {})\n    responseData = response.data\n  } catch (e) {\n    logger.error('ERROR', e)\n    if (isAxiosErrorResponse(e)) {\n      const messages: string[] = []\n      if (e.response.data) {\n        responseData = e.response.data as CancelJobResponse\n        if (Array.isArray(responseData.messages)) {\n          messages.splice(messages.length, 0, ...responseData.messages)\n        }\n      }\n      if (!messages.length) {\n        messages.push(\n          t(appName, 'Cancelling the background job failed with error {status}, \"{statusText}\".', {\n            status: e.response.status,\n            statusText: e.response.statusText,\n          }),\n        )\n      }\n      for (const message of messages) {\n        showError(message, { timeout: TOAST_PERMANENT_TIMEOUT })\n      }\n    }\n  }\n  if (responseData.removed) {\n    for (const job of responseData.removed) {\n      const jobId = getJobIdFromJob(job)\n      if (pendingJobs.value[jobId]) {\n        vueDel(pendingJobs.value, jobId)\n      }\n    }\n  }\n}\n\nconst getArchiveMounts = async (fileName: string, silent?: boolean) => {\n  const result: Omit<GetArchiveMountResponse, 'messages'> = {\n    mounts: [],\n    mounted: false,\n  }\n  if (silent !== true) {\n    ++loading.value\n  }\n  fileName = encodeURIComponent(fileName)\n  const url = generateAppUrl('archive/mount/{fileName}', { fileName })\n  try {\n    const response = await axios.get<GetArchiveMountResponse>(url)\n    const responseData = response.data\n    result.mounts = responseData.mounts\n    result.mounted = responseData.mounted\n    if (responseData.messages) {\n      for (const message of responseData.messages) {\n        showInfo(message)\n      }\n    }\n  } catch (e) {\n    logger.error('ERROR', e)\n    if (isAxiosErrorResponse(e) && e.response.data) {\n      const responseData = e.response.data as GetArchiveMountResponse\n      result.mounts = responseData.mounts\n      result.mounted = responseData.mounted\n      if (responseData.messages) {\n        for (const message of responseData.messages) {\n          showError(message, { timeout: TOAST_PERMANENT_TIMEOUT })\n        }\n      }\n    }\n  }\n  // id=\"fileList\"\n  // data-path\n  // data-file\n  for (const mount of result.mounts) {\n    // const pathComponents = mount.mountPointPath.split('/')\n    // const baseName = pathComponents.pop()\n    // const dirName = pathComponents.join('/')\n    // mount.baseName = baseName\n    // mount.dirName = dirName\n    if (!archivePassPhrase.value && mount.archivePassPhrase) {\n      archivePassPhrase.value = mount.archivePassPhrase\n    }\n    delete mount.archivePassPhrase\n  }\n  if (silent !== true) {\n    --loading.value\n  }\n  return result\n}\n\nconst mountArchive = async () => {\n  const archivePath = encodeURIComponent(fileName.value!)\n  const mountPath = encodeURIComponent(archiveMountPathName.value)\n  const urlTemplate = archiveMountBackgroundJob.value\n    ? 'archive/schedule/mount/{archivePath}/{mountPath}'\n    : 'archive/mount/{archivePath}/{mountPath}'\n  const url = generateAppUrl(urlTemplate, { archivePath, mountPath })\n  setBusyState(true)\n  const requestData: Record<string, string|boolean> = {}\n  if (archivePassPhrase.value) {\n    requestData.passPhrase = archivePassPhrase.value\n  }\n  requestData.stripCommonPathPrefix = !!archiveMountStripCommonPathPrefix.value\n  try {\n    const response = await axios.post<ArchiveMount>(url, requestData)\n    if (!archiveMountBackgroundJob.value) {\n      const newMount = response.data\n      const newFileId = newMount.mountPoint.fileid\n      if (archiveMounts.value.findIndex((mount) => mount.mountPoint.fileid === newFileId) === -1) {\n        archiveMounts.value.push(newMount)\n        const node = fileInfoToNode(response.data.mountPoint)\n        node.attributes['is-mount-root'] = true\n\n        emit('files:node:created', node)\n      }\n    }\n  } catch (e) {\n    logger.error('ERROR', e)\n    if (isAxiosErrorResponse(e)) {\n      const messages: string[] = []\n      if (e.response.data) {\n        const responseData = e.response.data as { messages?: string[] }\n        if (responseData.messages) {\n          messages.splice(messages.length, 0, ...responseData.messages)\n        }\n      }\n      if (!messages.length) {\n        messages.push(t(appName, 'Mount request failed with error {status}, \"{statusText}\".', {\n          status: e.response.status,\n          statusText: e.response.statusText,\n        }))\n      }\n      for (const message of messages) {\n        showError(message, { timeout: TOAST_PERMANENT_TIMEOUT })\n      }\n    }\n  }\n  if (archiveMountBackgroundJob.value) {\n    getPendingJobs(fileName.value!, true)\n  }\n  setBusyState(false)\n}\n\nconst unmount = async (mount: ArchiveMount) => {\n  const cloudUser = getCurrentUser()\n  const url = generateRemoteUrl('dav/files/' + cloudUser!.uid + mount.mountPointPath)\n  setBusyState(true)\n  try {\n    await axios.delete(url)\n    const mountIndex = archiveMounts.value.indexOf(mount)\n    if (mountIndex >= 0) {\n      archiveMounts.value.splice(mountIndex, 1)\n    } else {\n      logger.error('UNABLE TO FIND DELETED MOUNT IN LIST', mount, archiveMounts)\n    }\n    const node = fileInfoToNode(mount.mountPoint)\n    node.attributes['is-mount-root'] = true\n\n    emit('files:node:deleted', node)\n  } catch (e) {\n    logger.error('ERROR', e)\n    const messages: string[] = []\n    if (isAxiosErrorResponse(e)) {\n      // attempt parsing Sabre exception is available\n      const xml = (e.response.request as XMLHttpRequest)?.responseXML\n      if (xml && xml.documentElement.localName === 'error' && xml.documentElement.namespaceURI === 'DAV:') {\n        const xmlMessages = xml.getElementsByTagNameNS('http://sabredav.org/ns', 'message')\n        // const exceptions = xml.getElementsByTagNameNS('http://sabredav.org/ns', 'exception');\n        for (const message of xmlMessages) {\n          message.textContent && messages.push(message.textContent)\n        }\n      }\n      if (e.response.data) {\n        const responseData = e.response.data as { messages?: string[] }\n        if (responseData.messages) {\n          messages.splice(messages.length, 0, ...responseData.messages)\n        }\n      }\n      if (!messages.length) {\n        messages.push(t(appName, 'Unmount request failed with error {status}, \"{statusText}\".', {\n          status: e.response.status,\n          statusText: e.response.statusText,\n        }))\n      }\n      for (const message of messages) {\n        showError(message, { timeout: TOAST_PERMANENT_TIMEOUT })\n      }\n      if (e.response.status === 404) {\n        refreshArchiveMounts(fileName.value!, true)\n      }\n    }\n  }\n  setBusyState(false)\n}\n\nconst extractArchive = async () => {\n  const archivePath = encodeURIComponent(fileName.value!)\n  const targetPath = encodeURIComponent(archiveExtractPathName.value)\n  const urlTemplate = archiveExtractBackgroundJob.value\n    ? 'archive/schedule/extract/{archivePath}/{targetPath}'\n    : 'archive/extract/{archivePath}/{targetPath}'\n  const url = generateAppUrl(urlTemplate, { archivePath, targetPath })\n  setBusyState(true)\n  const requestData: Record<string, string|boolean> = {}\n  if (archivePassPhrase.value) {\n    requestData.passPhrase = archivePassPhrase.value\n  }\n  requestData.stripCommonPathPrefix = !!archiveExtractStripCommonPathPrefix.value\n  try {\n    const response = await axios.post<{ targetFolder: FileInfoDTO }>(url, requestData)\n    if (!archiveExtractBackgroundJob.value) {\n      const node = fileInfoToNode(response.data.targetFolder)\n      node.attributes['is-mount-root'] = true\n\n      emit('files:node:created', node)\n    }\n  } catch (e) {\n    logger.error('ERROR', e)\n    if (isAxiosErrorResponse(e)) {\n      const messages: string[] = []\n      if (e.response.data) {\n        const responseData = e.response.data as { messages?: string[] }\n        if (responseData.messages) {\n          messages.splice(messages.length, 0, ...responseData.messages)\n        }\n      }\n      if (!messages.length) {\n        messages.push(t(appName, 'Archive extraction failed with error {status}, \"{statusText}\".', {\n          status: e.response.status,\n          statusText: e.response.statusText,\n        }))\n      }\n      for (const message of messages) {\n        showError(message, { timeout: TOAST_PERMANENT_TIMEOUT })\n      }\n    }\n  }\n  if (archiveExtractBackgroundJob.value) {\n    getPendingJobs(fileName.value!, true)\n  }\n  setBusyState(false)\n}\n\nconst setPassPhrase = async () => {\n  const newPassPhrase: string = showArchivePassPhrase.value\n    ? archivePassPhraseComponent.value!.$el.querySelector<HTMLInputElement>('input[type=\"text\"]')?.value || ''\n    : archivePassPhraseComponent.value!.$el.querySelector<HTMLInputElement>('input[type=\"password\"]')?.value || ''\n  archivePassPhrase.value = newPassPhrase\n\n  // patch it into existing mounts if any\n  const archivePath = encodeURIComponent(fileName.value!)\n  const url = generateUrl('/apps/' + appName + '/archive/mount/{archivePath}', { archivePath })\n  setBusyState(true)\n  const requestData = {\n    changeSet: {\n      archivePassPhrase: archivePassPhrase.value,\n    },\n  }\n  try {\n    await axios.patch(url, requestData)\n  } catch (e) {\n    logger.error('ERROR', e)\n    if (isAxiosErrorResponse(e)) {\n      const messages: string[] = []\n      if (e.response.data) {\n        const responseData = e.response.data as { messages?: string[] }\n        if (responseData.messages) {\n          messages.splice(messages.length, 0, ...responseData.messages)\n        }\n      }\n      if (!messages.length) {\n        messages.push(t(appName, 'Patching the passphrase failed with error {status}, \"{statusText}\".', {\n          status: e.response.status,\n          statusText: e.response.statusText,\n        }))\n      }\n      for (const message of messages) {\n        showError(message, { timeout: TOAST_PERMANENT_TIMEOUT })\n      }\n    }\n  }\n  setBusyState(false)\n}\n\nconst togglePassPhraseVisibility = async () => {\n  // this is sooo complicated because the NC NcAction controls are\n  // seemingly only pro-forma vue-controls. There is no working\n  // v-model support, e.g.\n  let visibleElement = showArchivePassPhrase.value\n    ? archivePassPhraseComponent.value!.$el.querySelector<HTMLInputElement>('input[type=\"text\"]')!\n    : archivePassPhraseComponent.value!.$el.querySelector<HTMLInputElement>('input[type=\"password\"]')!\n  const currentValue: string = visibleElement.value\n\n  showArchivePassPhrase.value = !showArchivePassPhrase.value\n  await nextTick()\n\n  visibleElement = showArchivePassPhrase.value\n    ? archivePassPhraseComponent.value!.$el.querySelector<HTMLInputElement>('input[type=\"text\"]')!\n    : archivePassPhraseComponent.value!.$el.querySelector<HTMLInputElement>('input[type=\"password\"]')!\n  visibleElement.value = currentValue\n}\n\nconst filesAppMountPointUrl = (mountPoint: ArchiveMount) => {\n  return generateUrl('/apps/files') + '?dir=' + encodeURIComponent(mountPoint.mountPointPath)\n}\n\nconst onNotification = (event: NextcloudEvents['notifications:notification:received']) => {\n  if (event?.notification?.app !== appName) {\n    return\n  }\n  const destinationData = event?.notification?.messageRichParameters?.destination\n  if (destinationData?.status !== 'mount') {\n    return // nothing special ATM\n  }\n  const mountData = destinationData?.mount\n  if (!mountData) {\n    logger.error('No mount info in mount notification event')\n    return\n  }\n  let mount: ArchiveMountEntity\n  try {\n    mount = JSON.parse(mountData)\n  } catch (error) {\n    logger.error('files_archive, unable to decode mount entity', { event, mountData })\n    return\n  }\n  if (mount.archiveFileId !== archiveFileId.value) {\n    // not for us, in the future we may want to maintain a store\n    // and cache the data for all file-ids.\n    logger.info('*** Archive notification for other file received', event)\n    return\n  }\n  const jobId = getJobIdFromOperation('mount', mount.archiveFilePath, mount.mountPointPath)\n  if (pendingJobs.value[jobId]) {\n    delete pendingJobs.value[jobId]\n  }\n  logger.info('*** Mount notification received, updating mount-list', destinationData)\n  const mountFileId = destinationData.id\n  const mountIndex = archiveMounts.value.findIndex((mount) => mount.mountPoint.fileid === mountFileId)\n  if (mountIndex === -1) {\n    try {\n      archiveMounts.value.push({ ...mount, mountPoint: JSON.parse(destinationData.folder) })\n    } catch (error) {\n      logger.error('Unable to decode mount point folder file-info record.', { destinationData })\n    }\n  }\n}\n\nconst onMountPointRenamed = (mountPoint: Node) => {\n  // update the list of mountpoints\n  const mountFileId = mountPoint.fileid\n  const mountIndex = archiveMounts.value.findIndex((mount) => mount.mountPoint.fileid === mountFileId)\n  if (mountIndex >= 0) {\n    logger.info('BERFORE RENAME', { ...archiveMounts[mountIndex] })\n    vueSet(archiveMounts[mountIndex], 'mountPoint', mountPoint)\n    vueSet(archiveMounts[mountIndex], 'mountPointPath', mountPoint.path)\n    vueSet(archiveMounts[mountIndex], 'mountPointPathHash', md5(mountPoint.path))\n    logger.info('AFTER RENAME', { ...archiveMounts[mountIndex] })\n  } else {\n    logger.info('RENAME OF NODE NOT FOR US', mountPoint)\n  }\n}\n\nconst onMountPointDeleted = (mountPoint: Node) => {\n  const mountFileId = mountPoint.fileid\n  const mountIndex = archiveMounts.value.findIndex((mount) => mount.mountPoint.fileid === mountFileId)\n  if (mountIndex >= 0) {\n    archiveMounts.value.splice(mountIndex, 1)\n    logger.info('RECORD UNMOUNT', mountPoint)\n  } else {\n    logger.info('DELETE OF NODE NOT FOR US', {\n      mountPoint,\n      archiveMounts: archiveMounts.value,\n    })\n  }\n}\n\nonBeforeMount(() => {\n  subscribe('files:node:deleted', onMountPointDeleted)\n  subscribe('files:node:renamed', onMountPointRenamed)\n  subscribe('notifications:notification:received', onNotification)\n})\n\nonUnmounted(() => {\n  unsubscribe('files:node:deleted', onMountPointDeleted)\n  unsubscribe('files:node:renamed', onMountPointRenamed)\n  unsubscribe('notifications:notification:received', onNotification)\n})\n\n</script>\n<style lang=\"scss\" scoped>\n.files-tab {\n  .flex {\n    display:flex;\n    &.flex-center {\n      align-items:center;\n    }\n    &.flex-wrap {\n      flex-wrap:wrap;\n    }\n    .flex-grow {\n      flex-grow:1;\n    }\n  }\n  a.icon {\n    background-position: left;\n    padding-left:20px;\n  }\n  ::v-deep .archive-info {\n    .list-item__wrapper{\n      &:not(.archive-comment) {\n        .list-item-content__wrapper {\n          height:24px;\n        }\n        a.list-item {\n          padding:0;\n        }\n      }\n      &.archive-comment {\n        a.list-item {\n          padding:8px 0;\n          .line-two__subtitle {\n            max-width:100%;\n            white-space:normal;\n          }\n        }\n      }\n      &.archive-error {\n        .line-one__details {\n          font-weight:bold;\n          font-style:italic;\n          color:red;\n        }\n      }\n    }\n  }\n  .files-tab-entry {\n    min-height:44px;\n    &.clickable {\n      &, & * {\n        cursor:pointer;\n      }\n    }\n    .files-tab-entry__avatar {\n      width: 32px;\n      height: 32px;\n      line-height: 32px;\n      font-size: 18px;\n      background-color: var(--color-text-maxcontrast);\n      border-radius: 50%;\n      flex-shrink: 0;\n    }\n    .files-tab-entry__desc {\n      flex: 1 1;\n      padding: 8px;\n      line-height: 1.2em;\n      min-width:0;\n      h5 {\n        white-space: nowrap;\n        text-overflow: ellipsis;\n        overflow: hidden;\n        max-width: inherit;\n      }\n    }\n    &.directory-chooser {\n      .dirname {\n        font-weight:bold;\n        font-family:monospace;\n        .button {\n          display:block;\n        }\n      }\n      .label {\n        padding-right:0.5ex;\n      }\n    }\n    /* ::v-deep .archive-mounts {\n       .list-item-content > .list-item-content__actions {\n       display: block !important;\n       }\n       } */\n  }\n}\n</style>\n","import { render, staticRenderFns } from \"./FilesTab.vue?vue&type=template&id=36b940a4&scoped=true\"\nimport script from \"./FilesTab.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./FilesTab.vue?vue&type=script&setup=true&lang=ts\"\nimport style0 from \"./FilesTab.vue?vue&type=style&index=0&id=36b940a4&prod&lang=scss&scoped=true\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"36b940a4\",\n  null\n  \n)\n\nexport default component.exports","var render = function render(){var _vm=this,_c=_vm._self._c,_setup=_vm._self._setupProxy;return _c('div',{staticClass:\"files-tab\"},[_c('ul',[_c('li',{staticClass:\"files-tab-entry flex flex-center clickable\",on:{\"click\":function($event){_setup.showArchiveInfo = !_setup.showArchiveInfo}}},[_c('div',{staticClass:\"files-tab-entry__avatar icon-info-white\"}),_vm._v(\" \"),_c('div',{staticClass:\"files-tab-entry__desc\"},[_c('h5',[_vm._v(_vm._s(_setup.t(_setup.appName, 'Archive Information')))])]),_vm._v(\" \"),_c(_setup.NcActions,[_c(_setup.NcActionButton,{attrs:{\"icon\":'icon-triangle-' + (_setup.showArchiveInfo ? 'n' : 's')},model:{value:(_setup.showArchiveInfo),callback:function ($$v) {_setup.showArchiveInfo=$$v},expression:\"showArchiveInfo\"}})],1)],1),_vm._v(\" \"),_c('li',{directives:[{name:\"show\",rawName:\"v-show\",value:(_setup.showArchiveInfo),expression:\"showArchiveInfo\"}],staticClass:\"files-tab-entry\"},[(_setup.loading)?_c('div',{staticClass:\"icon-loading-small\"}):_vm._e(),_vm._v(\" \"),_c('ul',{directives:[{name:\"show\",rawName:\"v-show\",value:(!_setup.loading),expression:\"!loading\"}],staticClass:\"archive-info\"},[(_setup.isLt(0, _setup.archiveStatus))?_c(_setup.NcListItem,{class:{ 'archive-error': _setup.isLt(0, _setup.archiveStatus) },attrs:{\"name\":_setup.t(_setup.appName, 'archive status'),\"bold\":true,\"details\":_setup.archiveStatusText},scopedSlots:_vm._u([{key:\"icon\",fn:function(){return [_c('div',{staticClass:\"icon-error\"})]},proxy:true}],null,false,2833062560)}):_vm._e(),_vm._v(\" \"),_c(_setup.NcListItem,{attrs:{\"name\":_setup.t(_setup.appName, 'archive format'),\"bold\":true,\"details\":_setup.archiveInfo?.format || _setup.t(_setup.appName, 'unknown'),\"compact\":\"\"}}),_vm._v(\" \"),_c(_setup.NcListItem,{attrs:{\"name\":_setup.t(_setup.appName, 'MIME type'),\"bold\":true,\"details\":_setup.archiveInfo?.mimeType || _setup.t(_setup.appName, 'unknown'),\"compact\":\"\"}}),_vm._v(\" \"),_c(_setup.NcListItem,{attrs:{\"name\":_setup.t(_setup.appName, 'backend driver'),\"bold\":true,\"details\":_setup.archiveInfo?.backendDriver || _setup.t(_setup.appName, 'unknown'),\"compact\":\"\"}}),_vm._v(\" \"),_c(_setup.NcListItem,{attrs:{\"name\":_setup.t(_setup.appName, 'uncompressed size'),\"bold\":true,\"details\":_setup.humanArchiveOriginalSize,\"compact\":\"\"}}),_vm._v(\" \"),_c(_setup.NcListItem,{attrs:{\"name\":_setup.t(_setup.appName, 'compressed size'),\"bold\":true,\"details\":_setup.humanArchiveCompressedSize,\"compact\":\"\"}}),_vm._v(\" \"),(_setup.humanArchiveCompressedSize !== _setup.humanArchiveFileSize)?_c(_setup.NcListItem,{attrs:{\"name\":_setup.t(_setup.appName, 'archive file size'),\"bold\":true,\"details\":_setup.humanArchiveFileSize,\"compact\":\"\"}}):_vm._e(),_vm._v(\" \"),_c(_setup.NcListItem,{attrs:{\"name\":_setup.t(_setup.appName, '# archive members'),\"bold\":true,\"details\":_setup.numberOfArchiveMembers,\"compact\":\"\"}}),_vm._v(\" \"),_c(_setup.NcListItem,{attrs:{\"name\":_setup.t(_setup.appName, 'common prefix'),\"bold\":true,\"details\":_setup.commonPathPrefix,\"compact\":\"\"}}),_vm._v(\" \"),(_setup.archiveInfo?.comment)?_c(_setup.NcListItem,{staticClass:\"archive-comment\",attrs:{\"name\":_setup.t(_setup.appName, 'creator\\'s comment'),\"bold\":true,\"compact\":\"\"},scopedSlots:_vm._u([{key:\"subtitle\",fn:function(){return [_vm._v(\"\\n            \"+_vm._s(_setup.archiveInfo?.comment)+\"\\n          \")]},proxy:true}],null,false,3976111642)}):_vm._e()],1)]),_vm._v(\" \"),_c('li',{staticClass:\"files-tab-entry flex flex-center\"},[_c('div',{staticClass:\"files-tab-entry__avatar icon-password-white\"}),_vm._v(\" \"),_c('div',{staticClass:\"files-tab-entry__desc\"},[_c('h5',[_c('span',{staticClass:\"main-title\"},[_vm._v(_vm._s(_setup.t(_setup.appName, 'Passphrase')))]),_vm._v(\" \"),(!_setup.archivePassPhrase)?_c('span',{staticClass:\"title-annotation\"},[_vm._v(\"(\"+_vm._s(_setup.t(_setup.appName, 'unset'))+\")\")]):_vm._e()])]),_vm._v(\" \"),_c(_setup.NcActions,{attrs:{\"force-menu\":true}},[(_setup.showArchivePassPhrase)?_c(_setup.NcActionInput,{ref:\"archivePassPhraseComponent\",attrs:{\"value\":_setup.archivePassPhrase,\"type\":\"text\",\"icon\":\"icon-password\"},on:{\"submit\":_setup.setPassPhrase}},[_vm._v(\"\\n          \"+_vm._s(_setup.t(_setup.appName, 'archive passphrase'))+\"\\n        \")]):_c(_setup.NcActionInput,{ref:\"archivePassPhraseComponent\",attrs:{\"value\":_setup.archivePassPhrase,\"type\":\"password\",\"icon\":\"icon-password\"},on:{\"submit\":_setup.setPassPhrase}},[_vm._v(\"\\n          \"+_vm._s(_setup.t(_setup.appName, 'archive passphrase'))+\"\\n        \")]),_vm._v(\" \"),_c(_setup.NcActionCheckbox,{on:{\"change\":_setup.togglePassPhraseVisibility}},[_vm._v(\"\\n          \"+_vm._s(_setup.t(_setup.appName, 'Show Passphrase'))+\"\\n        \")])],1)],1),_vm._v(\" \"),_c('li',{staticClass:\"files-tab-entry flex flex-center clickable\",on:{\"click\":function($event){_setup.showArchiveMounts = !_setup.showArchiveMounts}}},[_c('div',{staticClass:\"files-tab-entry__avatar icon-external-white\"}),_vm._v(\" \"),_c('div',{staticClass:\"files-tab-entry__desc\"},[_c('h5',[_c('span',{staticClass:\"main-title\"},[_vm._v(_vm._s(_setup.t(_setup.appName, 'Mount Points')))]),_vm._v(\" \"),(_setup.archiveMounted)?_c('span',{staticClass:\"title-annotation\"},[_vm._v(\"(\"+_vm._s('' + _setup.archiveMounts.length)+\")\")]):_c('span',{staticClass:\"title-annotation\"},[_vm._v(\"(\"+_vm._s(_setup.t(_setup.appName, 'not mounted'))+\")\")])])]),_vm._v(\" \"),_c(_setup.NcActions,[_c(_setup.NcActionButton,{attrs:{\"icon\":'icon-triangle-' + (_setup.showArchiveMounts ? 'n' : 's')},model:{value:(_setup.showArchiveMounts),callback:function ($$v) {_setup.showArchiveMounts=$$v},expression:\"showArchiveMounts\"}})],1)],1),_vm._v(\" \"),_c('li',{directives:[{name:\"show\",rawName:\"v-show\",value:(_setup.showArchiveMounts),expression:\"showArchiveMounts\"}],staticClass:\"directory-chooser files-tab-entry\"},[(_setup.loading)?_c('div',{staticClass:\"icon-loading-small\"}):(_setup.archiveMounted)?_c('ul',{staticClass:\"archive-mounts\"},_vm._l((_setup.archiveMounts),function(mountPoint){return _c(_setup.NcListItem,{key:mountPoint.id,attrs:{\"force-display-actions\":true,\"bold\":false},scopedSlots:_vm._u([{key:\"title\",fn:function(){return [_c('a',{directives:[{name:\"tooltip\",rawName:\"v-tooltip\",value:(mountPoint.mountPointPath),expression:\"mountPoint.mountPointPath\"}],staticClass:\"external icon-folder icon\",attrs:{\"target\":_setup.openMountTarget,\"href\":_setup.filesAppMountPointUrl(mountPoint)}},[_vm._v(\"\\n              \"+_vm._s(mountPoint.mountPointPath)+\"\\n            \")])]},proxy:true},{key:\"actions\",fn:function(){return [_c(_setup.NcActionButton,{on:{\"click\":function($event){return _setup.unmount(mountPoint)}},scopedSlots:_vm._u([{key:\"icon\",fn:function(){return [_c(_setup.NetworkOffIcon,{directives:[{name:\"tooltip\",rawName:\"v-tooltip\",value:(_setup.t(_setup.appName, 'Disconnect storage')),expression:\"t(appName, 'Disconnect storage')\"}],attrs:{\"size\":20}})]},proxy:true}],null,true)})]},proxy:true},(mountPoint.mountFlags & 1)?{key:\"extra\",fn:function(){return [_c('div',[_vm._v(_vm._s(_setup.t(_setup.appName, 'Common prefix {prefix} is stripped.', { prefix: _setup.commonPathPrefix })))])]},proxy:true}:null],null,true)})}),1):_c('div',[_c(_setup.FilePrefixPicker,{attrs:{\"hint\":_setup.t(_setup.appName, 'Not mounted, create a new mount point:'),\"placeholder\":_setup.t(_setup.appName, 'base name')},on:{\"submit\":_setup.mountArchive},model:{value:(_setup.archiveMountFileInfo),callback:function ($$v) {_setup.archiveMountFileInfo=$$v},expression:\"archiveMountFileInfo\"}}),_vm._v(\" \"),_c('div',{staticClass:\"flex flex-center\"},[_c('div',{staticClass:\"label\",on:{\"click\":_setup.openMountOptionsMenu}},[_vm._v(\"\\n            \"+_vm._s(_setup.t(_setup.appName, 'Mount Options'))+\"\\n          \")]),_vm._v(\" \"),_c(_setup.NcActions,{ref:\"mountOptionsComponent\",attrs:{\"force-menu\":true}},[_c(_setup.NcActionCheckbox,{ref:\"mountStripCommonPathPrefixComponent\",attrs:{\"checked\":_setup.archiveMountStripCommonPathPrefix},on:{\"change\":function($event){_setup.archiveMountStripCommonPathPrefix = !_setup.archiveMountStripCommonPathPrefix}}},[_vm._v(\"\\n              \"+_vm._s(_setup.t(_setup.appName, 'strip common path prefix'))+\"\\n            \")]),_vm._v(\" \"),_c(_setup.NcActionCheckbox,{ref:\"mountBackgroundJobComponent\",attrs:{\"checked\":_setup.archiveMountBackgroundJob},on:{\"change\":function($event){_setup.archiveMountBackgroundJob = !_setup.archiveMountBackgroundJob}}},[_vm._v(\"\\n              \"+_vm._s(_setup.t(_setup.appName, 'schedule as background job'))+\"\\n            \")])],1)],1)],1)]),_vm._v(\" \"),_c('li',{staticClass:\"files-tab-entry flex flex-center clickable\",on:{\"click\":function($event){_setup.showArchiveExtraction = !_setup.showArchiveExtraction}}},[_c('div',{staticClass:\"files-tab-entry__avatar icon-play-white\"}),_vm._v(\" \"),_c('div',{staticClass:\"files-tab-entry__desc\"},[_c('h5',[_vm._v(_vm._s(_setup.t(_setup.appName, 'Extract Archive')))])]),_vm._v(\" \"),_c(_setup.NcActions,[_c(_setup.NcActionButton,{attrs:{\"icon\":'icon-triangle-' + (_setup.showArchiveExtraction ? 'n' : 's')},model:{value:(_setup.showArchiveExtraction),callback:function ($$v) {_setup.showArchiveExtraction=$$v},expression:\"showArchiveExtraction\"}})],1)],1),_vm._v(\" \"),_c('li',{directives:[{name:\"show\",rawName:\"v-show\",value:(_setup.showArchiveExtraction),expression:\"showArchiveExtraction\"}],staticClass:\"directory-chooser files-tab-entry\"},[(_setup.loading)?_c('div',{staticClass:\"icon-loading-small\"}):_c('div',[_c(_setup.FilePrefixPicker,{attrs:{\"hint\":_setup.t(_setup.appName, 'Choose a directory to extract the archive to:'),\"placeholder\":_setup.t(_setup.appName, 'basename')},on:{\"submit\":_setup.extractArchive},model:{value:(_setup.archiveExtractFileInfo),callback:function ($$v) {_setup.archiveExtractFileInfo=$$v},expression:\"archiveExtractFileInfo\"}}),_vm._v(\" \"),_c('div',{staticClass:\"flex flex-center\"},[_c('div',{staticClass:\"label\",on:{\"click\":_setup.openExtractionOptionsMenu}},[_vm._v(\"\\n            \"+_vm._s(_setup.t(_setup.appName, 'Extraction Options'))+\"\\n          \")]),_vm._v(\" \"),_c(_setup.NcActions,{ref:\"extractionOptionsComponent\",attrs:{\"force-menu\":true}},[_c(_setup.NcActionCheckbox,{attrs:{\"checked\":_setup.archiveExtractStripCommonPathPrefix},on:{\"change\":function($event){_setup.archiveExtractStripCommonPathPrefix = !_setup.archiveExtractStripCommonPathPrefix}}},[_vm._v(\"\\n              \"+_vm._s(_setup.t(_setup.appName, 'strip common path prefix'))+\"\\n            \")]),_vm._v(\" \"),_c(_setup.NcActionCheckbox,{ref:\"extractBackgroundJobComponent\",attrs:{\"checked\":_setup.archiveExtractBackgroundJob},on:{\"change\":function($event){_setup.archiveExtractBackgroundJob = !_setup.archiveExtractBackgroundJob}}},[_vm._v(\"\\n              \"+_vm._s(_setup.t(_setup.appName, 'schedule as background job'))+\"\\n            \")])],1)],1)],1)]),_vm._v(\" \"),_c('li',{staticClass:\"files-tab-entry flex flex-center clickable\",on:{\"click\":function($event){_setup.showPendingJobs = !_setup.showPendingJobs}}},[_c('div',{staticClass:\"files-tab-entry__avatar icon-recent-white\"}),_vm._v(\" \"),_c('div',{staticClass:\"files-tab-entry__desc\"},[(_setup.jobsArePending)?_c('h5',[_c('span',{staticClass:\"main-title\"},[_vm._v(_vm._s(_setup.t(_setup.appName, 'Pending Background Jobs')))]),_vm._v(\" \"),(_setup.jobsArePending)?_c('span',{staticClass:\"title-annotation\"},[_vm._v(\"(\"+_vm._s('' + Object.keys(_setup.pendingJobs).length)+\")\")]):_vm._e()]):_c('h5',[_c('span',{staticClass:\"main-title\"},[_vm._v(_vm._s(_setup.t(_setup.appName, 'No Pending Background Jobs')))])])]),_vm._v(\" \"),_c(_setup.NcActions,[_c(_setup.NcActionButton,{attrs:{\"icon\":'icon-triangle-' + (_setup.showPendingJobs ? 'n' : 's')},model:{value:(_setup.showPendingJobs),callback:function ($$v) {_setup.showPendingJobs=$$v},expression:\"showPendingJobs\"}})],1)],1),_vm._v(\" \"),_c('li',{directives:[{name:\"show\",rawName:\"v-show\",value:(_setup.jobsArePending && _setup.showPendingJobs),expression:\"jobsArePending && showPendingJobs\"}],staticClass:\"directory-chooser files-tab-entry\"},[(_setup.loading)?_c('div',{staticClass:\"icon-loading-small\"}):(_setup.jobsArePending)?_c('ul',{staticClass:\"pending-jobs\"},_vm._l((_setup.pendingJobs),function(job){return _c(_setup.NcListItem,{key:job.destinationPath,attrs:{\"force-display-actions\":true,\"bold\":false},scopedSlots:_vm._u([{key:\"title\",fn:function(){return [_c('div',[_vm._v(_vm._s(job.destinationPath))])]},proxy:true},{key:\"actions\",fn:function(){return [_c(_setup.NcActionButton,{on:{\"click\":function($event){return _setup.cancelPendingOperation(job.target)}},scopedSlots:_vm._u([{key:\"icon\",fn:function(){return [_c(_setup.CancelIcon,{directives:[{name:\"tooltip\",rawName:\"v-tooltip\",value:(_setup.t(_setup.appName, 'Cancel Job')),expression:\"t(appName, 'Cancel Job')\"}],attrs:{\"size\":20}})]},proxy:true}],null,true)})]},proxy:true},(job.stripCommonPathPrefix)?{key:\"extra\",fn:function(){return [_c('div',[_vm._v(_vm._s(_setup.t(_setup.appName, 'Job type: {type}', {type: job.target === 'mount' ? _setup.t(_setup.appName, 'mount') : _setup.t(_setup.appName, 'extract')})))]),_vm._v(\" \"),_c('div',[_vm._v(_vm._s(_setup.t(_setup.appName, 'Common prefix {prefix} will be stripped.', { prefix: _setup.commonPathPrefix })))])]},proxy:true}:null],null,true)})}),1):_c('div',[_vm._v(\"\\n        \"+_vm._s(_setup.t(_setup.appName, 'No pending background job.'))+\"\\n      \")])])])])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","/**\n * @author Claus-Justus Heine <himself@claus-justus-heine.de>\n * @copyright 2025 Claus-Justus Heine\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport { appName } from './config.ts';\nimport Vue from 'vue';\nimport { Tooltip } from '@nextcloud/vue';\nimport FilesTab from './views/FilesTab.vue';\nimport type { LegacyFileInfo } from '@nextcloud/files';\nimport { translate as t, translatePlural as n } from '@nextcloud/l10n';\n\ninterface FilesTabVue extends Vue {\n  update(fileInfo: LegacyFileInfo): Promise<unknown>,\n}\n\nVue.mixin({ data() { return { appName }; }, methods: { t, n } });\nVue.directive('tooltip', Tooltip);\n\nconst FilesTabVue = Vue.extend(FilesTab);\n\nconst createTabInstance = (parent: Vue):FilesTabVue => new FilesTabVue({ parent });\n\nexport default createTabInstance;\n"],"names":["generateUrl","url","urlParams","urlOptions","replace","generated","nextcloudGenerateUrl","appName","queryParams","_objectSpread","urlParam","matchAll","queryArray","key","value","Object","entries","push","encodeURIComponent","toString","e","console","debug","length","join","fileInfoToNode","fileInfo","owner","userFrontEndFolder","getCurrentUser","uid","topLevelFolder","Error","concat","path","nodeData","id","fileid","source","generateRemoteUrl","relativePath","root","mime","mtime","Date","lastmod","size","permissions","attributes","hasPreview","type","File","Folder","isAxiosErrorResponse","error","axios","isAxiosError","response","currentInstance","sidebarRoot","busyNodes","getSidebarRoot","_getCurrentInstance","instance","getCurrentInstance","proxy","$parent","$options","name","_instance","setSidebarNodeBusy","state","arguments","undefined","node","getSidebarNode","status","NodeStatus","LOADING","emit","splice","_defineComponent","__name","setup","__props","_ref","expose","setBusyState","archivePassPhraseComponent","ref","mountOptionsComponent","extractionOptionsComponent","loading","fileName","computed","archiveFileId","_fileInfo$value","archiveInfo","archiveStatus","archiveMounts","pendingJobs","jobsArePending","keys","initialState","getInitialState","archiveMountStripCommonPathPrefix","mountStripCommonPathPrefixDefault","archiveExtractStripCommonPathPrefix","extractStripCommonPathPrefixDefault","archiveMountBackgroundJob","mountBackgroundJob","archiveExtractBackgroundJob","extractBackgroundJob","archivePassPhrase","showArchiveInfo","showArchivePassPhrase","showArchiveMounts","showArchiveExtraction","showPendingJobs","openMountTarget","md5","archiveMountFileInfo","reactive","dirName","baseName","archiveExtractFileInfo","archiveMountBaseName","get","set","vueSet","archiveMountDirName","archiveExtractBaseName","archiveExtractDirName","archiveMountPathName","archiveExtractPathName","archiveStatusText","t","archiveMounted","humanArchiveOriginalSize","_archiveInfo$value","isNaN","parseInt","originalSize","formatFileSize","humanArchiveCompressedSize","_archiveInfo$value2","compressedSize","humanArchiveFileSize","_archiveInfo$value3","numberOfArchiveMembers","_archiveInfo$value4","_archiveInfo$value5","_archiveInfo$value6","numberOfFiles","commonPathPrefix","getData","async","getArchiveInfo","refreshArchiveMounts","getPendingJobs","update","newFileInfo","split","_archiveInfo$value7","_archiveInfo$value8","generateAppUrl","requestData","passPhrase","responseData","post","data","messages","message","showInfo","logger","showError","timeout","TOAST_PERMANENT_TIMEOUT","defaultMountPoint","defaultTargetBaseName","filename","noEmit","oldMounts","mounts","getArchiveMounts","newMounts","filter","mount","findIndex","oldMount","mountPoint","deletedMounts","getJobIdFromOperation","operation","archivePath","mountPath","getJobIdFromJob","job","target","sourcePath","destinationPath","silent","jobs","jobId","vueDel","result","mounted","onNotification","event","_event$notification","_event$notification2","notification","app","destinationData","messageRichParameters","destination","mountData","JSON","parse","info","archiveFilePath","mountPointPath","mountFileId","mountIndex","folder","onMountPointRenamed","onMountPointDeleted","onBeforeMount","subscribe","onUnmounted","unsubscribe","__sfc","ArchiveStatusOk","ArchiveStatusTooLarge","ArchiveStatusBomb","isLt","a","b","openMountOptionsMenu","_mountOptionsComponen","openMenu","openExtractionOptionsMenu","_extractionOptionsCom","cancelPendingOperation","delete","Array","isArray","statusText","removed","mountArchive","urlTemplate","stripCommonPathPrefix","newMount","newFileId","unmount","cloudUser","indexOf","_e$response$request","xml","request","responseXML","documentElement","localName","namespaceURI","xmlMessages","getElementsByTagNameNS","textContent","extractArchive","targetPath","targetFolder","setPassPhrase","_archivePassPhraseCom","_archivePassPhraseCom2","newPassPhrase","$el","querySelector","changeSet","patch","togglePassPhraseVisibility","visibleElement","currentValue","nextTick","filesAppMountPointUrl","NetworkOffIcon","CancelIcon","NcActionInput","NcActionCheckbox","NcActions","NcActionButton","NcListItem","FilePrefixPicker","_setup$archiveInfo","_setup$archiveInfo2","_setup$archiveInfo3","_setup$archiveInfo4","_vm","this","_c","_self","_setup","_setupProxy","staticClass","on","$event","_v","_s","attrs","model","callback","$$v","expression","directives","rawName","_e","class","scopedSlots","_u","fn","format","mimeType","backendDriver","comment","_setup$archiveInfo5","_l","mountFlags","prefix","Vue","mixin","methods","n","directive","Tooltip","FilesTabVue","extend","FilesTab","parent"],"sourceRoot":""}